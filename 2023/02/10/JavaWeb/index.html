<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
  <link rel="stylesheet" href="/lib/pace/pace-theme-minimal.min.css">
  <script src="/lib/pace/pace.min.js"></script>

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":true,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="Mysql基础 连接层 服务层 引擎层 存储层  DDL&#x2F;DML&#x2F;DQL：对数据库，表进行操作的语句Create database name;  创建一个名为name的数据库 drop database name;     删除一个名为name的数据库 use database name;        进入数据库  show tables;   显示所有表 desc tabl">
<meta property="og:type" content="article">
<meta property="og:title" content="Mysql学习">
<meta property="og:url" content="http://example.com/2023/02/10/JavaWeb/index.html">
<meta property="og:site_name" content="小金的学习日志">
<meta property="og:description" content="Mysql基础 连接层 服务层 引擎层 存储层  DDL&#x2F;DML&#x2F;DQL：对数据库，表进行操作的语句Create database name;  创建一个名为name的数据库 drop database name;     删除一个名为name的数据库 use database name;        进入数据库  show tables;   显示所有表 desc tabl">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/2023/02/10/JavaWeb/Users/Administrator/AppData/Roaming/Typora/typora-user-images/image-20221107154357740.png">
<meta property="og:image" content="http://example.com/2023/02/10/JavaWeb/Users/Administrator/AppData/Roaming/Typora/typora-user-images/image-20221005171337632.png">
<meta property="og:image" content="http://example.com/2023/02/10/JavaWeb/Users/Administrator/AppData/Roaming/Typora/typora-user-images/image-20221018153850695.png">
<meta property="og:image" content="http://example.com/2023/02/10/JavaWeb/Users/Administrator/AppData/Roaming/Typora/typora-user-images/image-20221018154731328.png">
<meta property="og:image" content="http://example.com/2023/02/10/JavaWeb/Users/Administrator/AppData/Roaming/Typora/typora-user-images/image-20221018154744388.png">
<meta property="og:image" content="http://example.com/2023/02/10/JavaWeb/Users/Administrator/AppData/Roaming/Typora/typora-user-images/image-20221018154711360.png">
<meta property="og:image" content="http://example.com/2023/02/10/JavaWeb/Users/Administrator/AppData/Roaming/Typora/typora-user-images/image-20221018154905540.png">
<meta property="og:image" content="http://example.com/2023/02/10/JavaWeb/Users/Administrator/AppData/Roaming/Typora/typora-user-images/image-20221018155059348.png">
<meta property="og:image" content="http://example.com/2023/02/10/JavaWeb/Users/Administrator/AppData/Roaming/Typora/typora-user-images/image-20221018155535596.png">
<meta property="og:image" content="http://example.com/2023/02/10/JavaWeb/Users/Administrator/AppData/Roaming/Typora/typora-user-images/image-20221018155644838.png">
<meta property="og:image" content="http://example.com/2023/02/10/JavaWeb/Users/Administrator/AppData/Roaming/Typora/typora-user-images/image-20221018155828803.png">
<meta property="og:image" content="http://example.com/2023/02/10/JavaWeb/Users/Administrator/AppData/Roaming/Typora/typora-user-images/image-20221018183237138.png">
<meta property="og:image" content="http://example.com/2023/02/10/JavaWeb/Users/Administrator/AppData/Roaming/Typora/typora-user-images/image-20221019163125919.png">
<meta property="og:image" content="http://example.com/2023/02/10/JavaWeb/Users/Administrator/AppData/Roaming/Typora/typora-user-images/image-20221019163315971.png">
<meta property="og:image" content="http://example.com/2023/02/10/JavaWeb/Users/Administrator/AppData/Roaming/Typora/typora-user-images/image-20221019165505924.png">
<meta property="og:image" content="http://example.com/2023/02/10/JavaWeb/Users/Administrator/AppData/Roaming/Typora/typora-user-images/image-20221019181020343.png">
<meta property="og:image" content="http://example.com/2023/02/10/JavaWeb/Users/Administrator/AppData/Roaming/Typora/typora-user-images/image-20221019182419349.png">
<meta property="og:image" content="http://example.com/2023/02/10/JavaWeb/Users/Administrator/AppData/Roaming/Typora/typora-user-images/image-20221019183132630.png">
<meta property="og:image" content="http://example.com/2023/02/10/JavaWeb/Users/Administrator/AppData/Roaming/Typora/typora-user-images/image-20221019183046987.png">
<meta property="og:image" content="http://example.com/2023/02/10/JavaWeb/Users/Administrator/AppData/Roaming/Typora/typora-user-images/image-20221019183610472.png">
<meta property="og:image" content="http://example.com/2023/02/10/JavaWeb/Users/Administrator/AppData/Roaming/Typora/typora-user-images/image-20221019183917703.png">
<meta property="og:image" content="http://example.com/2023/02/10/JavaWeb/Users/Administrator/AppData/Roaming/Typora/typora-user-images/image-20221019185325986.png">
<meta property="og:image" content="http://example.com/2023/02/10/JavaWeb/Users/Administrator/AppData/Roaming/Typora/typora-user-images/image-20221019192601260.png">
<meta property="og:image" content="http://example.com/2023/02/10/JavaWeb/Users/Administrator/AppData/Roaming/Typora/typora-user-images/image-20221020172541968.png">
<meta property="og:image" content="http://example.com/2023/02/10/JavaWeb/Users/Administrator/AppData/Roaming/Typora/typora-user-images/image-20221020172915664.png">
<meta property="og:image" content="http://example.com/2023/02/10/JavaWeb/Users/Administrator/AppData/Roaming/Typora/typora-user-images/image-20221020173131277.png">
<meta property="og:image" content="http://example.com/2023/02/10/JavaWeb/Users/Administrator/AppData/Roaming/Typora/typora-user-images/image-20221020173252720.png">
<meta property="og:image" content="http://example.com/2023/02/10/JavaWeb/Users/Administrator/AppData/Roaming/Typora/typora-user-images/image-20221021124019005.png">
<meta property="og:image" content="http://example.com/2023/02/10/JavaWeb/Users/Administrator/AppData/Roaming/Typora/typora-user-images/image-20221021192940985.png">
<meta property="og:image" content="http://example.com/2023/02/10/JavaWeb/Users/Administrator/AppData/Roaming/Typora/typora-user-images/image-20221021194537665.png">
<meta property="og:image" content="http://example.com/2023/02/10/JavaWeb/Users/Administrator/AppData/Roaming/Typora/typora-user-images/image-20221021200732033.png">
<meta property="og:image" content="http://example.com/2023/02/10/JavaWeb/Users/Administrator/AppData/Roaming/Typora/typora-user-images/image-20221021211436463.png">
<meta property="og:image" content="http://example.com/2023/02/10/JavaWeb/Users/Administrator/AppData/Roaming/Typora/typora-user-images/image-20221021211636112.png">
<meta property="og:image" content="http://example.com/2023/02/10/JavaWeb/Users/Administrator/AppData/Roaming/Typora/typora-user-images/image-20221022143719234.png">
<meta property="og:image" content="http://example.com/2023/02/10/JavaWeb/Users/Administrator/AppData/Roaming/Typora/typora-user-images/image-20221022131955079.png">
<meta property="og:image" content="http://example.com/2023/02/10/JavaWeb/Users/Administrator/AppData/Roaming/Typora/typora-user-images/image-20221022132005729.png">
<meta property="og:image" content="http://example.com/2023/02/10/JavaWeb/Users/Administrator/AppData/Roaming/Typora/typora-user-images/image-20221022134053744.png">
<meta property="og:image" content="http://example.com/2023/02/10/JavaWeb/Users/Administrator/AppData/Roaming/Typora/typora-user-images/image-20221022154609639.png">
<meta property="og:image" content="http://example.com/2023/02/10/JavaWeb/Users/Administrator/AppData/Roaming/Typora/typora-user-images/image-20221022163915238.png">
<meta property="og:image" content="http://example.com/2023/02/10/JavaWeb/Users/Administrator/AppData/Roaming/Typora/typora-user-images/image-20221022164445987.png">
<meta property="og:image" content="http://example.com/2023/02/10/JavaWeb/Users/Administrator/AppData/Roaming/Typora/typora-user-images/image-20221022165513387.png">
<meta property="og:image" content="http://example.com/2023/02/10/JavaWeb/Users/Administrator/AppData/Roaming/Typora/typora-user-images/image-20221022182120381.png">
<meta property="og:image" content="http://example.com/2023/02/10/JavaWeb/Users/Administrator/AppData/Roaming/Typora/typora-user-images/image-20221024145002611.png">
<meta property="og:image" content="http://example.com/2023/02/10/JavaWeb/Users/Administrator/AppData/Roaming/Typora/typora-user-images/image-20221026151527825.png">
<meta property="og:image" content="http://example.com/2023/02/10/JavaWeb/Users/Administrator/AppData/Roaming/Typora/typora-user-images/image-20221026153217098.png">
<meta property="og:image" content="http://example.com/2023/02/10/JavaWeb/Users/Administrator/AppData/Roaming/Typora/typora-user-images/image-20221026183021629.png">
<meta property="article:published_time" content="2023-02-10T14:07:08.000Z">
<meta property="article:modified_time" content="2023-03-15T17:03:14.147Z">
<meta property="article:author" content="Kim-Donghyun">
<meta property="article:tag" content="JDBC，状态码，Mybatis">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/2023/02/10/JavaWeb/Users/Administrator/AppData/Roaming/Typora/typora-user-images/image-20221107154357740.png">

<link rel="canonical" href="http://example.com/2023/02/10/JavaWeb/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>Mysql学习 | 小金的学习日志</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<link rel="alternate" href="/rss2.xml" title="小金的学习日志" type="application/rss+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>
    <a target="_blank" rel="noopener" href="https://github.com/Martin01Kim" aria-label="View source on GitHub"><svg width="80" height="80" viewBox="0 0 250 250" style="fill:#64CEAA; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">小金的学习日志</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-resources">

    <a href="/resources/" rel="section"><i class="fa fa-download fa-fw"></i>资源</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/02/10/JavaWeb/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Kim-Donghyun">
      <meta itemprop="description" content="希望现在的自己配得上所期望的生活">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="小金的学习日志">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Mysql学习
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2023-02-10 22:07:08" itemprop="dateCreated datePublished" datetime="2023-02-10T22:07:08+08:00">2023-02-10</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-03-16 01:03:14" itemprop="dateModified" datetime="2023-03-16T01:03:14+08:00">2023-03-16</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/JavaWeb/" itemprop="url" rel="index"><span itemprop="name">JavaWeb</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h1 id="Mysql基础"><a href="#Mysql基础" class="headerlink" title="Mysql基础"></a>Mysql基础</h1><ul>
<li>连接层</li>
<li>服务层</li>
<li>引擎层</li>
<li>存储层</li>
</ul>
<h2 id="DDL-x2F-DML-x2F-DQL：对数据库，表进行操作的语句"><a href="#DDL-x2F-DML-x2F-DQL：对数据库，表进行操作的语句" class="headerlink" title="DDL&#x2F;DML&#x2F;DQL：对数据库，表进行操作的语句"></a><strong>DDL&#x2F;DML&#x2F;DQL：对数据库，表进行操作的语句</strong></h2><p>Create database name;  创建一个名为name的数据库</p>
<p>drop database name;     删除一个名为name的数据库</p>
<p>use database name;        进入数据库</p>
<hr>
<p>show tables;   显示所有表</p>
<p>desc table ; 查询表的结构</p>
<p>create table tb_user(	id int comment ‘编号’	,	name varchar(20),	password varchar(20)	);  创建表，comment注释</p>
<p>drop table name；删除表</p>
<p>alter table  表名  rename to   新名字；     重命名</p>
<p>alter table 表名   add 名称，数据类型       添加一列 	           </p>
<p>alter table 表名   modify 名字，数据类型；修改一列的数据类型</p>
<p>alter table 表名  rename to 新表名;     修改列名</p>
<p>alter table 表名  change 名字，新名字，数据类型；  列名与数据类型一起修改</p>
<p>alter table 表名  drop 列名；删除某列</p>
<hr>
<p>整数 int                               id int</p>
<p>字符串 varchar（长度）  name varchar(20);  存储两个字符，就会开辟两个空间，最大开辟20个   节省空间，性能低</p>
<p> char 定长字符串              name char(10)  若存储两个字符，仍然会被看作10个空间，没存储的空间用空格代替    存储性能高，浪费空间</p>
<p>Date 日期                          birthday date</p>
<p>TIME 时间                          lunch time</p>
<p>DateTime 日期+时间       anniversary datetime</p>
<p>浮点数double（总长度，小数点后保留几位） money double(	5	,	2	);  表示存储0-100.00的数</p>
<hr>
<span id="more"></span>

<ul>
<li><p><strong>查询所有数据</strong></p>
</li>
<li><p>select 属性1，属性2 from student;  </p>
</li>
<li><p><strong>查询id为？的数据</strong></p>
</li>
<li><p>select 属性1，属性2 from student where id&#x3D;?;</p>
</li>
<li><p>&#96;&#96;&#96;mysql<br>select distinct joindate as ‘入职日期’ from emp  ;   &#x2F;&#x2F;查询数据除重，对查询列起别名</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- **按照特定条件统计分析，如求和，求最大值**</span><br><span class="line"></span><br><span class="line">- select 聚合函数(列名) from 表名；</span><br><span class="line"></span><br><span class="line">- 聚合函数：</span><br><span class="line"></span><br><span class="line">  max,count,min,avg,sum</span><br><span class="line"></span><br><span class="line">  **注意:所有NULL值不参与聚合函数的运算**</span><br><span class="line"></span><br><span class="line">- **where后还可以加或被替换为** </span><br><span class="line"></span><br><span class="line">1. limit 从第几条显示，每页显示几条数据</span><br><span class="line"></span><br><span class="line">2. order by  排序查找  **ASC升序，DESC降序**</span><br><span class="line"></span><br><span class="line">   例:先根据mgr升序排序，如果mgr相同，再根据salary升序排序</span><br><span class="line"></span><br><span class="line">   `select * from emp where mgr is not null order by mgr Asc,salary ASC ;`</span><br><span class="line"></span><br><span class="line">3. group by 分组查找</span><br><span class="line"></span><br><span class="line">4. having 分组后条件查找</span><br><span class="line"></span><br><span class="line">5. like 模糊查找（_表示单个字符  %为任意字符）</span><br><span class="line"></span><br><span class="line">6. in(值1，值2，值3)  范围查找，表示where id = 括号内的这些值的所有数据</span><br><span class="line"></span><br><span class="line">7. ......</span><br><span class="line"></span><br><span class="line">​			**Where与Having区别**</span><br><span class="line"></span><br><span class="line">1. Where分组之前过滤</span><br><span class="line">2. Having分组之后过滤</span><br><span class="line"></span><br><span class="line">​             综合示例：在emp表中计算出不同mgr的人，排除mgr为null的人（分组前过滤）</span><br><span class="line"></span><br><span class="line">​			DQL语句执行顺序：</span><br><span class="line"></span><br><span class="line">1. 执行from</span><br><span class="line">2. 执行Where</span><br><span class="line">3. 执行Group by , Having</span><br><span class="line">4. 执行Select</span><br><span class="line">5. 执行order by</span><br><span class="line">6. 执行limit</span><br><span class="line"></span><br><span class="line">​             `select mgr,count(*) as &#x27;mgr中每组人数&#x27; from emp where mgr is not null group by mgr ;`</span><br><span class="line"></span><br><span class="line">- **为表添加数据**</span><br><span class="line"></span><br><span class="line">- insert into student(属性1，属性2)    values ( 值1，值2)  //插入指定字段的值</span><br><span class="line"></span><br><span class="line">  insert into student values(值1，值2)；     //插入全部字段的值</span><br><span class="line"></span><br><span class="line">- **批量插入**</span><br><span class="line">- insert into  student  values(值1，值2),(值1，值2),(值1，值2); </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">- **修改id位置的属性1的值**</span><br><span class="line">- update student set 属性1=值1 where id=?;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">- **删除id=?的数据**</span><br><span class="line">- delete from studetn where id=?; </span><br><span class="line"></span><br><span class="line">## DCL:控制数据库的访问权限</span><br><span class="line"></span><br><span class="line">Create USER &#x27;用户名&#x27;@&#x27;主机名&#x27; identified by &#x27;密码&#x27;;</span><br><span class="line"></span><br><span class="line">**若想在任意主机上访问数据库，则主机名为%**</span><br><span class="line"></span><br><span class="line">ALTER USER &#x27;用户名&#x27;@&#x27;主机名&#x27; Identified with   mysql_native_password    by &#x27;新密码&#x27;;</span><br><span class="line"></span><br><span class="line">DROP USER &#x27;用户名&#x27;@&#x27;主机名&#x27;；</span><br><span class="line"></span><br><span class="line">## 约束</span><br><span class="line"></span><br><span class="line">主键约束 primary key</span><br><span class="line"></span><br><span class="line">非空约束 not null</span><br><span class="line"></span><br><span class="line">唯一约束 unique</span><br><span class="line"></span><br><span class="line">默认约束 default 值</span><br><span class="line"></span><br><span class="line">条件约束 CHECK</span><br><span class="line"></span><br><span class="line">外键约束 foreign  key   reference 主表（键）                 将两个表之间的数据建立连接</span><br><span class="line"></span><br><span class="line">alter table  表名  add   constraint 外键名 foreign key 从键 reference 主表(主键)</span><br><span class="line"></span><br><span class="line">#### 外键增删约束</span><br><span class="line"></span><br><span class="line">Cascade：当主表有增删操作时，会把子表对应的数据删除</span><br><span class="line"></span><br><span class="line">- ON UPDATE CASCADE</span><br><span class="line">- ON DELETE CASCADE</span><br><span class="line"></span><br><span class="line">SetNull:当主表有删除操作时，会把子表中对应的数据变为NULL</span><br><span class="line"></span><br><span class="line">## 事务</span><br><span class="line"></span><br><span class="line">一种机制，一种操作序列，包含了一组操作数据库的命令，这一组命令要么同时成功，要么同时失败</span><br><span class="line"></span><br><span class="line">BEGIN; 开启事务</span><br><span class="line"></span><br><span class="line">COMMIT; 提交事务</span><br><span class="line"></span><br><span class="line">ROLLBACK; 回滚事务</span><br><span class="line"></span><br><span class="line">事务四大特征：</span><br><span class="line"></span><br><span class="line">- 原子性：不可分割的最小操作单位，要么同时成功，要么同时失败</span><br><span class="line"></span><br><span class="line">- 一致性：事务完成时，必须使所有数据保持一致状态</span><br><span class="line"></span><br><span class="line">- 隔离性：多个事务之间，操作的可见性</span><br><span class="line"></span><br><span class="line">- 持久性：事务一但提交或回滚，对数据的影响就是永久的</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">```mysql</span><br><span class="line">begin;</span><br><span class="line">update account set money = money-1000 where name = &#x27;张三&#x27;;</span><br><span class="line">update account set money = money+1000 where name = &#x27;李四&#x27;;</span><br><span class="line">commit ;</span><br><span class="line">rollback ;</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="并发事务问题"><a href="#并发事务问题" class="headerlink" title="并发事务问题"></a>并发事务问题</h2><ul>
<li>脏读：一个事务读取到另一个事务还没有提交的数据</li>
<li>不可重复读：一个事务先后读取到同一个数据，但读到的两个数据不同</li>
<li>幻读：一个事务按照条件查询时没查询到对应的数据行，但在插入数据时，这行数据又出现，好像出现了幻影</li>
</ul>
<p>解决方法：事务的隔离级别</p>
<ul>
<li>Read Uncommited  读未提交 ：所有问题都会出现</li>
<li>Read commited  读已提交 ：脏读不会出现</li>
<li>Repetable Read 默认隔离级别 ：幻读会出现</li>
<li>Serializable 序列化 ：所有问题都可以解决</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">select @@transaction_isolation; //查看当前会话隔离级别</span><br><span class="line">set session transaction isolation level SERIALIZABLE ; //修改当前会话隔离级别</span><br></pre></td></tr></table></figure>

<h2 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h2><h3 id="字符串函数"><a href="#字符串函数" class="headerlink" title="字符串函数"></a>字符串函数</h3><p>CONCAT(str1,str2,str3….) 字符串拼接</p>
<p>LOWWER(str)  字符串变成小写</p>
<p>UPPER(str)   字符串变成大写</p>
<p>LPAD(str,n,pad)  将字符串左边填充pad直到长度为n，pad自定</p>
<p>RPAD(str,n,pad)  将字符串右边填充pad直到长度为n，pad自定</p>
<p>trim(str)  去除字符串两边的空格，不会去除字符串内部的空格</p>
<p>subString(str,start,len)  字符串从start截取，截取len长度  <strong>注意，数据库中的下标从1开始</strong></p>
<h3 id="数值函数"><a href="#数值函数" class="headerlink" title="数值函数"></a>数值函数</h3><ul>
<li>ceil()  向上取整</li>
<li>floor()   向下取整</li>
<li>rand()  生成0-1随机数</li>
<li>round(value，n)  四舍五入，参数n代表返回的数保留几位小数</li>
<li>mod()   取模</li>
</ul>
<h3 id="日期函数"><a href="#日期函数" class="headerlink" title="日期函数"></a>日期函数</h3><ul>
<li>CURDATE();获取当前年月日 </li>
<li>CURTIME();获取当前时分秒</li>
<li>NOW();获取当前年月日，时分秒</li>
<li>YEAR(DATE);获取年</li>
<li>MONTH(DATE);获取月</li>
<li>DAY(DATE);获取日</li>
<li>DATEDIFF(DATE1,DATE2) 获取两个时间的间隔时间</li>
<li>DATE_ADD(DATE, INTERVAL value type) ;在指定type上加或减一个value的值</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select date_add(now(),INTERVAL 70 DAY);</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select ename,datediff(now(),joindate) as &#x27;EntryDays&#x27; from emp where mgr is not null order by EntryDays ASC</span><br></pre></td></tr></table></figure>

<h3 id="流程函数"><a href="#流程函数" class="headerlink" title="流程函数"></a>流程函数</h3><ul>
<li>if(value，t，f) 如果Value为真，返回T，否则返回F</li>
<li>IFNULL(value1，value2)   如果value1不为null，返回value1，否则返回value2</li>
<li>CASE WHEN [value1] THEN[RES1] …….. ELSE[default] END  如果value1为真，返回res1，….如果都不为真，返回default</li>
<li>Case [expr]  when [value1] Then [res1] …… ELSE[default] END 如果expr值等于value1，返回res1，如果都不相等，返回default</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">select *,if(salary &gt; 20000 ,&#x27;高薪&#x27; ,&#x27;低薪&#x27; ) from emp order by salary desc;</span><br><span class="line">//查询所有员工，如果工资高于20000则为高薪，否贼为低薪</span><br></pre></td></tr></table></figure>

<h2 id="多表查询"><a href="#多表查询" class="headerlink" title="多表查询"></a>多表查询</h2><p>表间关系</p>
<ul>
<li>一对多：多的那方为外键的从键</li>
<li>多对多：需要额外新建一个表，设置两个键，分别为另外两个表的从键</li>
<li>一对一：用于单表拆分，提升效率，设置外键时要设置为Unique</li>
</ul>
<p>多表查询时会出现笛卡尔积，若想消除多余的笛卡尔积，则只需要让外键关联的两个键值相等即可</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select *  from emp,dept where emp.dept_id = dept.id;</span><br></pre></td></tr></table></figure>

<p>内连接：查询两个表交集条件可以为on或者where</p>
<ul>
<li>隐式内连接    Select * from 表1,表2 where</li>
<li>显示内连接    Select * from 表1 INNER Join 表2 where…</li>
</ul>
<p>外连接：注意条件为on</p>
<ul>
<li>左外连接:查询左表全部以及两表交集</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select *  from emp  left outer join dept  on emp.dept_id = dept.id;</span><br></pre></td></tr></table></figure>

<ul>
<li>右外连接:右表全部以及两表交集</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select *  from emp  right outer join dept  on emp.dept_id = dept.id;</span><br></pre></td></tr></table></figure>

<p>自连接：与自身连接查询，必须使用表的别名</p>
<ul>
<li><p>把一个表当成两张表，用不同的别名分别代表不同的表</p>
</li>
<li><p>查询员工的领导, 没有领导也需要查询出来</p>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select a.name,b.name &#x27;领导名字&#x27; from emp a left join emp b on a.manager_id = b.id;</span><br></pre></td></tr></table></figure>

<h2 id="联合查询-union-，union-all"><a href="#联合查询-union-，union-all" class="headerlink" title="联合查询-union ，union all"></a>联合查询-union ，union all</h2><ul>
<li><p>使用条件，两次查询的列数要相同</p>
</li>
<li><p>union all会将两次查询结果直接合并</p>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">select * from emp where salary&lt;5000</span><br><span class="line">union all</span><br><span class="line">select * from emp where mgr&gt;1004;</span><br></pre></td></tr></table></figure>

<ul>
<li>union会将查询后的结果合并后去重</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">select * from emp where salary&lt;5000</span><br><span class="line">union </span><br><span class="line">select * from emp where mgr&gt;1004;</span><br></pre></td></tr></table></figure>

<h2 id="嵌套查询-x2F-子查询"><a href="#嵌套查询-x2F-子查询" class="headerlink" title="嵌套查询&#x2F;子查询"></a>嵌套查询&#x2F;子查询</h2><p>Select语句中嵌套了一个Select语句，内部的select语句为嵌套查询</p>
<p>子查询语句要被括号包住</p>
<ul>
<li>标量子查询：内部select语句返回的是一个量</li>
<li>列子查询：内部的select返回的是一列数据</li>
<li>常用操作符：any， some， all， in， not in</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from emp where salary &gt; all (select salary from emp where dept_id = 10);</span><br></pre></td></tr></table></figure>

<ul>
<li>行子查询；内部的select语句返回的是一行的数据</li>
<li>常用操作符:&#x3D; ,&lt;&gt; ,in, not in</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from emp where (name,manager_id) = (select name,manager_id from emp where name = &#x27;张无忌&#x27;)</span><br></pre></td></tr></table></figure>

<ul>
<li>表子查询；内部的select语句返回的是一张表的数据</li>
<li>常用操作符 in</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from emp where (name,manager_id) in (select name,manager_id from emp where name = &#x27;张无忌&#x27;)</span><br></pre></td></tr></table></figure>

<h2 id="存储引擎各自特点"><a href="#存储引擎各自特点" class="headerlink" title="存储引擎各自特点"></a>存储引擎各自特点</h2><h3 id="INNODB-默认引擎-事务，外键，行级锁"><a href="#INNODB-默认引擎-事务，外键，行级锁" class="headerlink" title="INNODB(默认引擎): 事务，外键，行级锁"></a>INNODB(默认引擎): 事务，外键，行级锁</h3><p>高可靠性，高性能，DML遵循ACID模型,支持事务；</p>
<p>行级锁，提高并发访问性能；</p>
<p>支持外键约束，保证数据的完整性和正确性</p>
<p>存储文件名: XXX.ibd，每一张表对应一张表空间文件</p>
<ul>
<li>一个表空间包含若干个段Segment，一个段中包含多个区Extent，一个区包含若干个页Page，一个页包含若干个行Row</li>
<li>一个区大小1MB ,一个页大小16KB ,一个区可以包含64个页</li>
</ul>
<h3 id="MYIsam：不支持事务，不支持外键，不支持行锁，支持表锁"><a href="#MYIsam：不支持事务，不支持外键，不支持行锁，支持表锁" class="headerlink" title="MYIsam：不支持事务，不支持外键，不支持行锁，支持表锁"></a>MYIsam：不支持事务，不支持外键，不支持行锁，支持表锁</h3><p>存储性能较快</p>
<p>创建文件</p>
<ol>
<li>xxx.sdi 存储表结构</li>
<li>xxx.myd   存储数据</li>
<li>xxx.myi  存储索引</li>
</ol>
<h3 id="MeMory：内存存放，支持Hash索引"><a href="#MeMory：内存存放，支持Hash索引" class="headerlink" title="MeMory：内存存放，支持Hash索引"></a>MeMory：内存存放，支持Hash索引</h3><p>读性能较快，但是断电时数据会丢失</p>
<p>存储文件名:xxx.sdi 存储表结构</p>
<h3 id="存储引擎的选择"><a href="#存储引擎的选择" class="headerlink" title="存储引擎的选择:"></a>存储引擎的选择:</h3><ul>
<li>InnoDB：如果对事务的完整性，并发性比较高，并且有很多的删改操作，少量的读，增加操作，是唯一选择</li>
<li>MyIsam：经常执行读操作，插入操作，有很少的更新删除操作，对事务的并发性，完整性要求也不高</li>
<li>Memory：大小有限制，并且无法保证安全性，只用于临时表和缓存</li>
</ul>
<h1 id="JDBC"><a href="#JDBC" class="headerlink" title="JDBC"></a>JDBC</h1><p>连接步骤：</p>
<p>•给出url、username，password其中url背下来！</p>
<p>•使用DriveManager类来得到Connection对象！</p>
<p><strong>具体代码实现</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">jdbcTest</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">URL</span> <span class="operator">=</span> <span class="string">&quot;jdbc:mysql://127.0.0.1:3306/test&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">USER</span> <span class="operator">=</span> <span class="string">&quot;root&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">PASSWORD</span> <span class="operator">=</span> <span class="string">&quot;jdx525&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">//获取链接</span></span><br><span class="line">        <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> DriverManager.getConnection(URL,USER,PASSWORD);</span><br><span class="line">        <span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> <span class="string">&quot;update account set money = 2000 where id=1&quot;</span>;</span><br><span class="line">        <span class="comment">//执行sql对象</span></span><br><span class="line">        <span class="type">Statement</span> <span class="variable">statement</span> <span class="operator">=</span> connection.createStatement();</span><br><span class="line">        <span class="type">int</span> <span class="variable">a</span> <span class="operator">=</span> statement.executeUpdate(str); <span class="comment">//返回值为受影响的行数</span></span><br><span class="line">        System.out.println(a);</span><br><span class="line">        <span class="comment">//释放资源</span></span><br><span class="line">        statement.close();</span><br><span class="line">        connection.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="DriverManager"><a href="#DriverManager" class="headerlink" title="DriverManager"></a>DriverManager</h2><p><strong>作用：注册驱动  获取数据库连接</strong></p>
<h2 id="Connection"><a href="#Connection" class="headerlink" title="Connection"></a>Connection</h2><p><strong>获取执行sql的对象，管理事务</strong></p>
<p>createStatement</p>
<p>prepareStatement（sql）  防止sql注入</p>
<p>prepareCall（sql）</p>
<p><strong>获取事务管理</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    connection.setAutoCommit(<span class="literal">false</span>);   <span class="comment">//开启事务</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">a</span> <span class="operator">=</span> statement.executeUpdate(str1); <span class="comment">//返回值为受影响的行数</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">b</span> <span class="operator">=</span> statement.executeUpdate(str2); <span class="comment">//返回值为受影响的行数</span></span><br><span class="line">    System.out.println(a);</span><br><span class="line">    <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">3</span>/<span class="number">0</span>;</span><br><span class="line">    connection.commit();    <span class="comment">//提交事务</span></span><br><span class="line">&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">    connection.rollback();   <span class="comment">//事务回滚</span></span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Statement"><a href="#Statement" class="headerlink" title="Statement"></a>Statement</h2><p><strong>执行sql方法</strong></p>
<p><strong>返回值int        executeUpdate（str）   执行DML,DDL语句  （ 对数据的操作）</strong></p>
<p>**返回值resultset      executeQuery （str）   执行DQL语句  （查询数据 ）  **   </p>
<h2 id="ResultSet"><a href="#ResultSet" class="headerlink" title="ResultSet"></a>ResultSet</h2><p>结果集对象</p>
<p>返回值resultset      executeQuery （str）   执行DQL语句  （查询数据 ） </p>
<p><strong>resultset.next（）返回值为boolean，判断当前行是否有效</strong></p>
<p><strong>resultset.getXXX（参数）获取数据 返回值自己定义</strong></p>
<p><strong>参数有两种形式：1.列的编号</strong></p>
<p>​                               <strong>2.列对应的名称</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">jdbcTest2</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">URL</span> <span class="operator">=</span> <span class="string">&quot;jdbc:mysql://127.0.0.1:3306/test&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">USER</span> <span class="operator">=</span> <span class="string">&quot;root&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">PASSWORD</span> <span class="operator">=</span> <span class="string">&quot;jdx525&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        ArrayList&lt;Account&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>();</span><br><span class="line">        <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> DriverManager.getConnection(URL, USER, PASSWORD);</span><br><span class="line">        <span class="type">Statement</span> <span class="variable">statement</span> <span class="operator">=</span> connection.createStatement();</span><br><span class="line">        <span class="type">String</span> <span class="variable">str1</span> <span class="operator">=</span> <span class="string">&quot;select * from account&quot;</span>;</span><br><span class="line">        <span class="type">ResultSet</span> <span class="variable">resultSet</span> <span class="operator">=</span> statement.executeQuery(str1);</span><br><span class="line">        <span class="keyword">while</span>(resultSet.next())&#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">i1</span> <span class="operator">=</span> resultSet.getInt(<span class="string">&quot;id&quot;</span>);</span><br><span class="line">            <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> resultSet.getString(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">            <span class="type">int</span> <span class="variable">money</span> <span class="operator">=</span> resultSet.getInt(<span class="string">&quot;money&quot;</span>);</span><br><span class="line">            <span class="type">Account</span> <span class="variable">account</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Account</span>(i1,name,money);</span><br><span class="line">            list.add(account);</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(list);</span><br><span class="line">        resultSet.close();</span><br><span class="line">        statement.close();</span><br><span class="line">        connection.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>定义一个Account类，将从数据库中获取的数据装入Account对象中，再将Account对象装入ArrayList，输出list</p>
<h2 id="prepareStatement"><a href="#prepareStatement" class="headerlink" title="prepareStatement"></a>prepareStatement</h2><p>防止SQL注入</p>
<p>SQL注入原理：将敏感字符进行转义</p>
<p><strong>预防原理：用问号做为占位符替代之前拼接字符串的操作,外部在输入特殊语句时，会将 ‘ 转义，使处理sql语句时内部会变为一个字符串，不会产生 or ‘1’ &#x3D; ‘1’语句</strong></p>
<p><strong>sql语句：”select * from account where user &#x3D; ? and password &#x3D; ?”;</strong></p>
<p><strong>prepareStatement &#x3D; connection.prepareStatement（sql语句）</strong></p>
<p><strong>perparedStatement.setXXX（index,value,index2,value2）;分别给问号赋值，下标从一开始</strong> </p>
<p><strong>XXX为数据类型，内部为具体值</strong></p>
<p>执行：executeQuerry（）不需要传递sql语句</p>
<p><strong>整体运行效率更高：</strong></p>
<p><strong>创建preparedStatement时，就已经将sql语句发送给服务器去检查编译，不需要执行时再检查编译</strong></p>
<p><strong>当两条sql语句模板相同时，只需要写一条sql语句，去更改两次占位符的值就可以，减少了发送给服务器去检查编译的次数</strong></p>
<h2 id="数据库连接池"><a href="#数据库连接池" class="headerlink" title="数据库连接池"></a>数据库连接池</h2><p><strong>允许资源的复用。提高运行效率，避免连接遗漏</strong></p>
<p><strong>内部存放多个connection</strong></p>
<p>标准接口：datasource</p>
<p>Durid基本配置文件</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">driverClassName = com.mysql.jdbc.Driver</span><br><span class="line">url=jdbc:mysql:<span class="comment">//test?useSSL=false&amp;useServePrepStmts=true</span></span><br><span class="line">username = <span class="type">root</span></span><br><span class="line"><span class="variable">password</span> <span class="operator">=</span> jdx525</span><br><span class="line">#初始化连接数</span><br><span class="line">initialSize=<span class="number">5</span></span><br><span class="line">#最大连接数</span><br><span class="line">maxActive=<span class="number">10</span></span><br><span class="line">#最大等待时间</span><br><span class="line">maxWait = <span class="number">3000</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DruidTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">//加载配置文件</span></span><br><span class="line">        <span class="type">Properties</span> <span class="variable">prop</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Properties</span>();</span><br><span class="line">        prop.load(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="string">&quot;D:\\JDBCPractise\\src\\Druid.properties&quot;</span>));</span><br><span class="line">        <span class="comment">//创建数据池</span></span><br><span class="line">        <span class="type">DataSource</span> <span class="variable">dataSource</span> <span class="operator">=</span> DruidDataSourceFactory.createDataSource(prop);</span><br><span class="line">        <span class="comment">//获取数据连接</span></span><br><span class="line">        <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> dataSource.getConnection();</span><br><span class="line">        System.out.println(connection);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>大概使用流程</p>
<h1 id="Mybatis"><a href="#Mybatis" class="headerlink" title="Mybatis"></a>Mybatis</h1><h2 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h2><p>配置时一定要遵循前后顺序</p>
<p><a target="_blank" rel="noopener" href="https://mybatis.net.cn/configuration.html">配置_MyBatis中文网</a></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;property name=<span class="string">&quot;driver&quot;</span> value=<span class="string">&quot;com.mysql.cj.jdbc.Driver&quot;</span>&gt;&lt;/property&gt;</span><br><span class="line">&lt;property name=<span class="string">&quot;url&quot;</span> value=<span class="string">&quot;jdbc:mysql:///mybatis&quot;</span>&gt;&lt;/property&gt;</span><br><span class="line">&lt;property name=<span class="string">&quot;username&quot;</span> value= <span class="string">&quot;root&quot;</span>&gt;&lt;/property&gt;</span><br><span class="line">&lt;property name=<span class="string">&quot;password&quot;</span> value=<span class="string">&quot;jdx525&quot;</span>&gt;&lt;/property&gt;</span><br></pre></td></tr></table></figure>

<p><strong>编写SQL映射文件，配置文件中加载对应的sql映射文件</strong>（从mybatis官网上查找对应文件语句）</p>
<p><strong>加载核心配置文件，获取sqlsession</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">resource</span> <span class="operator">=</span> <span class="string">&quot;mybatis-config.xml&quot;</span>;</span><br><span class="line">    <span class="type">InputStream</span> <span class="variable">inputStream</span> <span class="operator">=</span> Resources.getResourceAsStream(resource);</span><br><span class="line">    <span class="type">SqlSessionFactory</span> <span class="variable">sqlSessionFactory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SqlSessionFactoryBuilder</span>().build(inputStream);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Mapper代理开发"><a href="#Mapper代理开发" class="headerlink" title="Mapper代理开发"></a><strong>Mapper代理开发</strong></h2><p>四个步骤</p>
<ul>
<li>创建一个与映射文件同名的接口，并将接口与映射文件放在同一个目录下</li>
</ul>
<p><img src="/2023/02/10/JavaWeb/Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20221107154357740.png" alt="image-20221107154357740"></p>
<p><strong>因为MAVEN项目要保证配置文件与执行文件分开，所以只需要在resources文件夹下创建一个与mapper接口同路径的文件夹，将映射文件放进即可，具体原理可以用maven的compile编译查看层次结构</strong></p>
<ul>
<li>设置映射文件的namespace为mapper接口全限定名</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;mapper namespace=<span class="string">&quot;com.jdc.mapper.userMapper&quot;</span>&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li>在mapper接口中定义方法，方法名就是映射文件中sql语句的id值，保证参数类型和返回类型一致</li>
<li>编译执行语句</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//获取sqlSession</span></span><br><span class="line"><span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> sqlSessionFactory.openSession();</span><br><span class="line"><span class="comment">//创建UserMapper对象</span></span><br><span class="line"><span class="type">userMapper</span> <span class="variable">userMapper</span> <span class="operator">=</span> sqlSession.getMapper(userMapper.class);</span><br><span class="line"><span class="comment">//调用方法</span></span><br><span class="line"><span class="type">List</span> <span class="variable">users</span> <span class="operator">=</span> userMapper.selectAll();</span><br><span class="line">System.out.println(users);</span><br></pre></td></tr></table></figure>

<p><strong>注意将映射文件装进同名mapper包下时，可以在mybatis映射文件中修改mapper路径，改为package扫描模式</strong></p>
<p><em>数据库的字段与pojo类的字段名字不一样时，数据不能自动封装，有两种方案</em>*</p>
<p>①对查询字段起别名，让别名与pojo类对应字段名字一样</p>
<p>②创建一个sql片段，将重复字段变成一个常量，类似JAVA中的一个变量</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;sql id=<span class="string">&quot;brand_coloum&quot;</span>&gt;  <span class="comment">//创建sql片段</span></span><br><span class="line">   brand_name as brandName , company_name as companyName</span><br><span class="line">&lt;/sql&gt;</span><br><span class="line">&lt;include refid=<span class="string">&quot;brand_coloum&quot;</span>/&gt;  <span class="comment">//使用时只需要输入这段话即可</span></span><br></pre></td></tr></table></figure>

<p><strong>③resultMap</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;resultMap id=<span class="string">&quot;brand_resultMap&quot;</span> type=<span class="string">&quot;brand&quot;</span>&gt;</span><br><span class="line">    &lt;!--id子标签用来完成主键字段的映射</span><br><span class="line">    result子标签用来完成一般字段映射--&gt;</span><br><span class="line">             &lt;!--table列名                   pojo属性名--&gt;</span><br><span class="line">    &lt;result column=<span class="string">&quot;company_name&quot;</span> property=<span class="string">&quot;companyName&quot;</span>/&gt;</span><br><span class="line">    &lt;result column=<span class="string">&quot;brand_name&quot;</span> property=<span class="string">&quot;brandName&quot;</span>/&gt;</span><br><span class="line">&lt;/resultMap&gt;</span><br><span class="line">&lt;select id=<span class="string">&quot;select1All&quot;</span> resultMap=<span class="string">&quot;brand_resultMap&quot;</span>&gt;</span><br><span class="line">    select * from tb_brand</span><br><span class="line">&lt;/select&gt;</span><br></pre></td></tr></table></figure>

<p><strong>注意，定义完resultMap属性后，要用resultMap属性去替换 sql语句中的返回值resultType</strong></p>
<h2 id="带参查询"><a href="#带参查询" class="headerlink" title="带参查询"></a>带参查询</h2><p><strong>参数占位符：</strong></p>
<p><strong>①#{}  编译时，会换成？，防止sql注入</strong></p>
<p><strong>②￥{}  编译时，会拼成 id &#x3D; int ，容易发生sql注入</strong></p>
<p><strong>特殊字符处理：当输入&lt;号，因xml原因，会将xml认为为标签开始括号</strong></p>
<p>①转义字符：将&lt;号换成&amp;lt；</p>
<p>②CDATA区 ：将内部看作文本  ， 写时直接输入CD然后点提示</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;![CDATA[</span><br><span class="line">    填入符号</span><br><span class="line">]]&gt;</span><br></pre></td></tr></table></figure>

<h2 id="条件查询"><a href="#条件查询" class="headerlink" title="条件查询"></a>条件查询</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Brand&gt; <span class="title function_">selectByMore</span><span class="params">(<span class="meta">@Param(&quot;company&quot;)</span> String company,<span class="meta">@Param(&quot;brand&quot;)</span> String brand,<span class="meta">@Param(&quot;status&quot;)</span> <span class="type">int</span> status)</span>;                      <span class="comment">//占位符大括号内名字</span></span><br></pre></td></tr></table></figure>

<p>多参数输入时，用@Param表明当前数据输入给哪个占位符</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Brand&gt; <span class="title function_">selectByMore</span><span class="params">(Brand brand)</span>;</span><br></pre></td></tr></table></figure>

<p>当占位符参数属于同一个对象时，可以输入一个对象，注意，占位符内的名字要与pojo类中字段的名字一样</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Brand&gt; <span class="title function_">selectByMore</span><span class="params">(Map map)</span>;</span><br></pre></td></tr></table></figure>

<p>键对应占位符中的内容，值对应要输入的内容</p>
<p><strong>因为使用了模糊查询，要注意输入的数据两边需要加入%</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Brand&gt; list = brandmapper.selectByMore(<span class="string">&quot;%华为%&quot;</span>,<span class="string">&quot;%华为%&quot;</span>,<span class="number">1</span>);</span><br></pre></td></tr></table></figure>

<h2 id="动态查询"><a href="#动态查询" class="headerlink" title="动态查询"></a>动态查询</h2><p><a target="_blank" rel="noopener" href="https://mybatis.net.cn/dynamic-sql.html">动态 SQL_MyBatis中文网</a></p>
<p>where后的1&#x3D;1作为缓冲条件，防止起始条件没输入导致报错</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;select id=<span class="string">&quot;selectByMore&quot;</span> resultMap=<span class="string">&quot;brand_resultMap&quot;</span>&gt;</span><br><span class="line">    select * from tb_brand where <span class="number">1</span>=<span class="number">1</span></span><br><span class="line">       &lt;<span class="keyword">if</span> test=<span class="string">&quot;company!=null and company !=&#x27;&#x27;&quot;</span>&gt;</span><br><span class="line">           and company_name like #&#123;company&#125;</span><br><span class="line">       &lt;/<span class="keyword">if</span>&gt;</span><br><span class="line">       &lt;<span class="keyword">if</span> test=<span class="string">&quot;status!=null&quot;</span>&gt;</span><br><span class="line">            <span class="type">and</span> <span class="variable">status</span> <span class="operator">=</span> #&#123;status&#125;</span><br><span class="line">       &lt;/<span class="keyword">if</span>&gt;</span><br><span class="line">       &lt;<span class="keyword">if</span> test=<span class="string">&quot;brand!=null and brand != &#x27;&#x27;&quot;</span>&gt;</span><br><span class="line">            and brand_name like #&#123;brand&#125;</span><br><span class="line">       &lt;/<span class="keyword">if</span>&gt;</span><br><span class="line"></span><br><span class="line">&lt;/select&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;select id=<span class="string">&quot;selectByMore&quot;</span> resultMap=<span class="string">&quot;brand_resultMap&quot;</span>&gt;</span><br><span class="line">    select * from tb_brand</span><br><span class="line">    &lt;where&gt;</span><br><span class="line">       &lt;<span class="keyword">if</span> test=<span class="string">&quot;company!=null and company !=&#x27;&#x27;&quot;</span>&gt;</span><br><span class="line">           and company_name like #&#123;company&#125;</span><br><span class="line">       &lt;/<span class="keyword">if</span>&gt;</span><br><span class="line">       &lt;<span class="keyword">if</span> test=<span class="string">&quot;status!=null&quot;</span>&gt;</span><br><span class="line">            <span class="type">and</span> <span class="variable">status</span> <span class="operator">=</span> #&#123;status&#125;</span><br><span class="line">       &lt;/<span class="keyword">if</span>&gt;</span><br><span class="line">       &lt;<span class="keyword">if</span> test=<span class="string">&quot;brand!=null and brand != &#x27;&#x27;&quot;</span>&gt;</span><br><span class="line">            and brand_name like #&#123;brand&#125;</span><br><span class="line">       &lt;/<span class="keyword">if</span>&gt;</span><br><span class="line">    &lt;/where&gt;</span><br><span class="line">&lt;/select&gt;</span><br></pre></td></tr></table></figure>

<p><strong>方案二：用<where>包裹查询条件，根据用户填写条件不同实现动态查询，若只有一个参数，则会去掉对应sql语句前的</where></strong></p>
<p><strong>and，防止报错</strong></p>
<h3 id="单选择多条件动态查询"><a href="#单选择多条件动态查询" class="headerlink" title="单选择多条件动态查询"></a>单选择多条件动态查询</h3><p>从多个条件选择一个进行查询</p>
<p>choose（when，otherwise） 类似JAVA中的Switch Case  ，otherwise为default</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;select id=<span class="string">&quot;selectByMore&quot;</span> resultMap=<span class="string">&quot;brand_resultMap&quot;</span>&gt;</span><br><span class="line">    select * from tb_brand where</span><br><span class="line">    &lt;choose&gt;</span><br><span class="line">        &lt;when test=<span class="string">&quot;company!=null and company !=&#x27;&#x27;&quot;</span>&gt;</span><br><span class="line">            company_name like #&#123;company&#125;</span><br><span class="line">        &lt;/when&gt;</span><br><span class="line">        &lt;when test=<span class="string">&quot;brand!=null and brand != &#x27;&#x27;&quot;</span>&gt;</span><br><span class="line">            brand_name like #&#123;brand&#125;</span><br><span class="line">        &lt;/when&gt;</span><br><span class="line">        &lt;when test=<span class="string">&quot;status!=null&quot;</span>&gt;</span><br><span class="line">            status = #&#123;status&#125;</span><br><span class="line">        &lt;/when&gt;</span><br><span class="line">        &lt;otherwise&gt;</span><br><span class="line">            <span class="number">1</span>=<span class="number">1</span></span><br><span class="line">        &lt;/otherwise&gt;</span><br><span class="line">    &lt;/choose&gt;</span><br><span class="line">&lt;/select&gt;</span><br></pre></td></tr></table></figure>

<p>其中1&#x3D;1也可以去掉，用<where>去将条件包裹，防止不输入条件报错</where></p>
<h2 id="插入数据"><a href="#插入数据" class="headerlink" title="插入数据"></a>插入数据</h2><p>mybatis中会自动开启事务，添加时去用sqlsession.commit();去提交事务</p>
<p>不想开启事务，则需要在openSession中填入true</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span>  sqlSessionFactory.openSession();   <span class="comment">//是否开启事务，默认开启</span></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="type">Brand</span> <span class="variable">brand</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Brand</span>(<span class="number">4</span>, <span class="number">100</span>, <span class="string">&quot;b&quot;</span>, <span class="string">&quot;a&quot;</span>, <span class="string">&quot;d&quot;</span>, <span class="number">1</span>);</span><br><span class="line">    brandmapper.insertIntoBrand(brand);</span><br><span class="line">    sqlSession.commit();   <span class="comment">//提交事务</span></span><br><span class="line">&#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">    sqlSession.rollback();   <span class="comment">//回滚事务</span></span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Exception</span>(e);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>主键返回</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">                              设置为<span class="literal">true</span>                   指向id的属性名称</span><br><span class="line">&lt;insert id=<span class="string">&quot;insertIntoBrand&quot;</span> useGeneratedKeys=<span class="string">&quot;true&quot;</span> keyProperty=<span class="string">&quot;id&quot;</span>&gt;</span><br><span class="line">                                  </span><br><span class="line"> insert into <span class="title function_">tb_brand</span><span class="params">(brand_name,company_name,ordered,description,status)</span> </span><br><span class="line">                                  </span><br><span class="line">  values (#&#123;brandName&#125;,#&#123;companyName&#125;,#&#123;ordered&#125;,#&#123;description&#125;,#&#123;status&#125;)</span><br><span class="line">                                  </span><br><span class="line">&lt;/insert&gt;</span><br></pre></td></tr></table></figure>

<p>修改数据</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&lt;update id=<span class="string">&quot;updateBrand&quot;</span>&gt;</span><br><span class="line">    update tb_brand</span><br><span class="line">&lt;set&gt;</span><br><span class="line">&lt;<span class="keyword">if</span> test=<span class="string">&quot;brandName!=null&quot;</span>&gt;</span><br><span class="line">    brand_name = #&#123;brandName&#125;</span><br><span class="line">&lt;/<span class="keyword">if</span>&gt;</span><br><span class="line">&lt;<span class="keyword">if</span> test=<span class="string">&quot;companyName!=null&quot;</span>&gt;</span><br><span class="line">    company_name = #&#123;companyName&#125;</span><br><span class="line">&lt;/<span class="keyword">if</span>&gt;</span><br><span class="line">&lt;<span class="keyword">if</span> test=<span class="string">&quot;ordered != null&quot;</span>&gt;</span><br><span class="line">    ordered = #&#123;ordered&#125;</span><br><span class="line">&lt;/<span class="keyword">if</span>&gt;</span><br><span class="line">&lt;<span class="keyword">if</span> test=<span class="string">&quot;description!=null&quot;</span>&gt;</span><br><span class="line">    description = #&#123;description&#125;</span><br><span class="line">&lt;/<span class="keyword">if</span>&gt;</span><br><span class="line">&lt;<span class="keyword">if</span> test=<span class="string">&quot;status!=null and status betweend 0 and 1&quot;</span>&gt;</span><br><span class="line">    status = #&#123;status&#125;</span><br><span class="line">&lt;/<span class="keyword">if</span>&gt;</span><br><span class="line">&lt;/set&gt;</span><br><span class="line">    <span class="type">where</span> <span class="variable">id</span> <span class="operator">=</span> #&#123;id&#125;</span><br><span class="line">&lt;/update&gt;</span><br></pre></td></tr></table></figure>

<h2 id="批量删除"><a href="#批量删除" class="headerlink" title="批量删除"></a>批量删除</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;delete id=<span class="string">&quot;deleteByIds&quot;</span>&gt;</span><br><span class="line">        delete from tb_brand where  id <span class="title function_">in</span><span class="params">(         //每个id之间用逗号分隔，开始前输入括号，用）结尾</span></span><br><span class="line"><span class="params">               &lt;foreach collection=<span class="string">&quot;ids&quot;</span> item=<span class="string">&quot;id&quot;</span> separator=<span class="string">&quot;,&quot;</span> open=<span class="string">&quot;(&quot;</span> close=<span class="string">&quot;)&quot;</span>&gt; </span></span><br><span class="line"><span class="params">    //遍历送进来的数组</span></span><br><span class="line"><span class="params">                   #&#123;id&#125;</span></span><br><span class="line"><span class="params">               &lt;/foreach&gt;</span></span><br><span class="line"><span class="params">                        )</span>;</span><br><span class="line">    &lt;/delete&gt;</span><br></pre></td></tr></table></figure>

<p>注意 当collection内不为array时，要在方法参数中加@param指定参数传递给collection内的内容</p>
<h2 id="Mybatis参数传递"><a href="#Mybatis参数传递" class="headerlink" title="Mybatis参数传递"></a>Mybatis参数传递</h2><h3 id="多个参数传递，会封装进Map集合中"><a href="#多个参数传递，会封装进Map集合中" class="headerlink" title="多个参数传递，会封装进Map集合中"></a><strong>多个参数传递，会封装进Map集合中</strong></h3><p><strong>其中一个参数对应的下标为arg0，param1</strong></p>
<p><strong>新添加一个参数，对应参数就加一，变为arg1，param2</strong></p>
<p><strong>所以多个参数传递时，若没有@param指定，则会用arg0去调用</strong></p>
<p><strong>使用@Param注释之后，则会改变对应的arg键的名称</strong></p>
<p><strong>例如@Param（”name“） 下面调用时则会找#{}内是否有name，有则将值传递到sql语句中</strong></p>
<h3 id="单个参数"><a href="#单个参数" class="headerlink" title="单个参数"></a>单个参数</h3><p>传递类型</p>
<p>1.pojo类型：直接使用，注意pojo属性名一定要和参数占位符内容一致</p>
<p>2.Map集合：直接使用，键名要和参数占位符名称一致</p>
<p>3.其他类型，如int：直接使用</p>
<p>4.collection：会先转换成一个Map类型的数据，键为arg0，collection</p>
<p>5.list ：同理会转换成一个Map集合，键为arg0，collection，list</p>
<p>6.array：同理，键为arg0，array</p>
<h2 id="使用注解完成增删改查"><a href="#使用注解完成增删改查" class="headerlink" title="使用注解完成增删改查"></a>使用注解完成增删改查</h2><p>@Select 括号内写语句</p>
<p>@Insert   括号内写语句</p>
<p>@Update  括号内写语句</p>
<p>@Delete  括号内写语句</p>
<p><strong>使用注解完成简单的功能</strong></p>
<p><strong>复杂的功能需要用XML来完成，如动态查询</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Select(&quot;select * from tb_user where id = #&#123;id&#125;&quot;)</span></span><br><span class="line">User <span class="title function_">findById</span><span class="params">(<span class="type">int</span> id)</span>;</span><br></pre></td></tr></table></figure>





<h1 id="JavaWeb核心"><a href="#JavaWeb核心" class="headerlink" title="JavaWeb核心"></a>JavaWeb核心</h1><h2 id="Http传输协议"><a href="#Http传输协议" class="headerlink" title="Http传输协议"></a>Http传输协议</h2><p>基于Tcp协议：面向连接，安全（三次握手）</p>
<p>请求响应模型：一次请求对应一次响应</p>
<p>无状态的协议：对于事务处理没有记忆能力，每次请求响应都是独立的</p>
<p>缺点：多次请求不能共享数据，JAVA使用会话技术解决不能共享数据的问题</p>
<p>优点：速度更快</p>
<h2 id="请求数据部分"><a href="#请求数据部分" class="headerlink" title="请求数据部分"></a>请求数据部分</h2><p>三部分：</p>
<p>请求行：get或post或….&#x2F;请求资源路径   http&#x2F;协议版本</p>
<p>请求头：key：value格式</p>
<p>请求体：Post请求的最后一部分，在请求头空一行的位置</p>
<p><strong>get与post区别，get的请求参数在请求行内，没有请求体，且长度有限制</strong></p>
<p><strong>post请求参数在请求体中</strong></p>
<h2 id="响应数据部分"><a href="#响应数据部分" class="headerlink" title="响应数据部分"></a>响应数据部分</h2><p><img src="/2023/02/10/JavaWeb/Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20221005171337632.png" alt="image-20221005171337632"></p>
<p>响应行：HTTP&#x2F;1.1 表示协议及版本号  . 200表示状态码  ，OK状态码描述</p>
<p>响应头: KEY : VALUE格式</p>
<p>响应体：存放响应数据</p>
<h2 id="状态码大类"><a href="#状态码大类" class="headerlink" title="状态码大类"></a>状态码大类</h2><table>
<thead>
<tr>
<th>状态码分类</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>1xx</td>
<td><strong>响应中</strong>——临时状态码，表示请求已经接受，告诉客户端应该继续请求或者如果它已经完成则忽略它</td>
</tr>
<tr>
<td>2xx</td>
<td><strong>成功</strong>——表示请求已经被成功接收，处理已完成</td>
</tr>
<tr>
<td>3xx</td>
<td><strong>重定向</strong>——重定向到其它地方：它让客户端再发起一个请求以完成整个处理。</td>
</tr>
<tr>
<td>4xx</td>
<td><strong>客户端错误</strong>——处理发生错误，责任在客户端，如：客户端的请求一个不存在的资源，客户端未被授权，禁止访问等</td>
</tr>
<tr>
<td>5xx</td>
<td><strong>服务器端错误</strong>——处理发生错误，责任在服务端，如：服务端抛出异常，路由出错，HTTP版本不支持等</td>
</tr>
</tbody></table>
<p>状态码大全：<a target="_blank" rel="noopener" href="https://cloud.tencent.com/developer/chapter/13553">https://cloud.tencent.com/developer/chapter/13553</a> </p>
<h2 id="常见的响应状态码"><a href="#常见的响应状态码" class="headerlink" title="常见的响应状态码"></a>常见的响应状态码</h2><table>
<thead>
<tr>
<th>状态码</th>
<th>英文描述</th>
<th>解释</th>
</tr>
</thead>
<tbody><tr>
<td>200</td>
<td><strong><code>OK</code></strong></td>
<td>客户端请求成功，即<strong>处理成功</strong>，这是我们最想看到的状态码</td>
</tr>
<tr>
<td>302</td>
<td><strong><code>Found</code></strong></td>
<td>指示所请求的资源已移动到由<code>Location</code>响应头给定的 URL，浏览器会自动重新访问到这个页面</td>
</tr>
<tr>
<td>304</td>
<td><strong><code>Not Modified</code></strong></td>
<td>告诉客户端，你请求的资源至上次取得后，服务端并未更改，你直接用你本地缓存吧。隐式重定向</td>
</tr>
<tr>
<td>400</td>
<td><strong><code>Bad Request</code></strong></td>
<td>客户端请求有<strong>语法错误</strong>，不能被服务器所理解</td>
</tr>
<tr>
<td>403</td>
<td><strong><code>Forbidden</code></strong></td>
<td>服务器收到请求，但是<strong>拒绝提供服务</strong>，比如：没有权限访问相关资源</td>
</tr>
<tr>
<td>404</td>
<td><strong><code>Not Found</code></strong></td>
<td><strong>请求资源不存在</strong>，一般是URL输入有误，或者网站资源被删除了</td>
</tr>
<tr>
<td>428</td>
<td><strong><code>Precondition Required</code></strong></td>
<td><strong>服务器要求有条件的请求</strong>，告诉客户端要想访问该资源，必须携带特定的请求头</td>
</tr>
<tr>
<td>429</td>
<td><strong><code>Too Many Requests</code></strong></td>
<td><strong>太多请求</strong>，可以限制客户端请求某个资源的数量，配合 Retry-After(多长时间后可以请求)响应头一起使用</td>
</tr>
<tr>
<td>431</td>
<td><strong><code> Request Header Fields Too Large</code></strong></td>
<td><strong>请求头太大</strong>，服务器不愿意处理请求，因为它的头部字段太大。请求可以在减少请求头域的大小后重新提交。</td>
</tr>
<tr>
<td>405</td>
<td><strong><code>Method Not Allowed</code></strong></td>
<td>请求方式有误，比如应该用GET请求方式的资源，用了POST</td>
</tr>
<tr>
<td>500</td>
<td><strong><code>Internal Server Error</code></strong></td>
<td><strong>服务器发生不可预期的错误</strong>。服务器出异常了，赶紧看日志去吧</td>
</tr>
<tr>
<td>503</td>
<td><strong><code>Service Unavailable</code></strong></td>
<td><strong>服务器尚未准备好处理请求</strong>，服务器刚刚启动，还未初始化好</td>
</tr>
<tr>
<td>511</td>
<td><strong><code>Network Authentication Required</code></strong></td>
<td><strong>客户端需要进行身份验证才能获得网络访问权限</strong></td>
</tr>
</tbody></table>
<h1 id="Mysql进阶"><a href="#Mysql进阶" class="headerlink" title="Mysql进阶"></a>Mysql进阶</h1><h2 id="索引"><a href="#索引" class="headerlink" title="索引"></a>索引</h2><p>是帮助Mysql高效获取数据的数据结构（有序）</p>
<ul>
<li>B+Tree索引</li>
<li>Hash索引 只能进行精确匹配 ，仅能在memory引擎下使用</li>
<li>B-tree 空间索引，仅在MyIsam下使用</li>
<li>Full-text全文索引，Memory下不支持</li>
</ul>
<p>二叉树缺点：顺序存储时，结构会退化成链表，效率低，数据多时，层级较深，效率也比较低</p>
<h2 id="B-Tree：多路平衡查找树"><a href="#B-Tree：多路平衡查找树" class="headerlink" title="B-Tree：多路平衡查找树"></a>B-Tree：多路平衡查找树</h2><p><img src="/2023/02/10/JavaWeb/Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20221018153850695.png" alt="image-20221018153850695"></p>
<p>当数据小于20时走最左边的指针，数据在20-30中间时走第二个指针，再30-62中间走中间的指针，以此类推，当有N个Key时，有N+1个指针，Key下挂着具体的数据</p>
<p>构建B树顺序</p>
<ul>
<li>假设最大度数为5时，前四个数据会按序放到第一个结点中，当第五个数据加入后，中间的数据会向上发生裂变，将两边的数据变为左右子树</li>
</ul>
<p><img src="/2023/02/10/JavaWeb/Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20221018154731328.png" alt="image-20221018154731328"></p>
<ul>
<li>第六个数据加入后，若比中间的数据大，则添加到右子树当中，反之则添加到左子树当中</li>
</ul>
<p><img src="/2023/02/10/JavaWeb/Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20221018154744388.png" alt="image-20221018154744388"></p>
<ul>
<li>继续添加后，当任意左右子树有4个key后，再向其添加数据，则仍会发生裂变，子树中间的数据向上发生裂变，到父节点中，原子树变成父节点的两个子树</li>
</ul>
<p><img src="/2023/02/10/JavaWeb/Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20221018154711360.png" alt="image-20221018154711360"></p>
<ul>
<li>当演化到如下情况后</li>
</ul>
<p><img src="/2023/02/10/JavaWeb/Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20221018154905540.png" alt="image-20221018154905540"></p>
<ul>
<li>父节点饱和，含4个key，此时子树若进行向上分裂，父节点也变成5个key，此时父节点继续向上分裂，结果如下</li>
</ul>
<p><img src="/2023/02/10/JavaWeb/Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20221018155059348.png" alt="image-20221018155059348"></p>
<h2 id="B-Tree：B树变种"><a href="#B-Tree：B树变种" class="headerlink" title="B+Tree：B树变种"></a>B+Tree：B树变种</h2><p>区别:所有的元素都会出现在叶子节点中，非叶子节点起到索引作用，而B树元素存放在每一个结点中</p>
<p>存储演变</p>
<ul>
<li>大致过程与B树一样，但在向上分裂时，向上分裂的元素会保留在叶子节点中，叶子节点形成一个单向链表</li>
</ul>
<p><img src="/2023/02/10/JavaWeb/Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20221018155535596.png" alt="image-20221018155535596"></p>
<ul>
<li>继续添加元素，若左右子树发生向上分裂，同样，如下图</li>
</ul>
<p><img src="/2023/02/10/JavaWeb/Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20221018155644838.png" alt="image-20221018155644838"></p>
<p>在Mysql中，在相邻的叶子节点中增加了一个链表指针，形成了一个带有顺序指针的B+Tree</p>
<p><img src="/2023/02/10/JavaWeb/Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20221018155828803.png" alt="image-20221018155828803"></p>
<h2 id="Hash索引"><a href="#Hash索引" class="headerlink" title="Hash索引"></a>Hash索引</h2><p>采用一定的Hash算法，将键算出对应的hash值，映射到对应的槽位上，然后存储在hash表中，查找效率高，不发生hash碰撞的情况下，通常只需要一次索引就够了</p>
<p><strong>在InnoDB中，有自适应hash功能，根据我们的查询条件，会自动将B+树构建为Hash索引</strong></p>
<h2 id="为什么使用B-树"><a href="#为什么使用B-树" class="headerlink" title="为什么使用B+树"></a>为什么使用B+树</h2><p>相较于二叉树，在顺序存储时二叉树会退化成链表结构，存储效率比较低，在大量存储数据时，红黑树层级会高，存储效率也比较低，相较于B树，一个页中既存放KEY,指针，又存放数据，导致同一个结点中能存放的key和指针比较少，而B+树所有数据存放在叶子结点中，非叶子节点作为索引使用，所以一个结点能存放的key和指针相对来说比较多，层级会更少，并且B+树形成了一个链表，便于范围搜索和排序，相较于HASH索引，只支持精确匹配，不支持范围匹配与排序操作</p>
<h2 id="索引分类"><a href="#索引分类" class="headerlink" title="索引分类"></a>索引分类</h2><ul>
<li>主键索引 PRIMARY，只能有一个</li>
<li>唯一索引 UNIQUE</li>
<li>常规索引</li>
<li>全文索引 FULLTEXT,查找文中的关键字</li>
</ul>
<p>在InnoDB中，根据索引的存储形式，又可分为以下两种</p>
<ul>
<li>聚集索引：将数据存储与索引放到了一起，索引结构的叶子节点是行数据</li>
<li>二级索引：数据与索引分开存储，索引结构的叶子节点关联的是对应的主键</li>
</ul>
<p><img src="/2023/02/10/JavaWeb/Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20221018183237138.png" alt="image-20221018183237138"></p>
<p>聚集索引必须有，且只有一个</p>
<p>聚集索引选取规则</p>
<ul>
<li>如果有主键，主键则为聚集索引</li>
<li>如果没有主键，则唯一索引为聚集索引</li>
<li>如果都没有，则会自动生成一个rollid作为隐藏的聚集索引</li>
</ul>
<p>回表索引步骤：</p>
<ul>
<li>例如Select * from user where name &#x3D; ‘kit’;</li>
<li>会先通过二级索引找到对应的主键id值</li>
<li>找到主键id值后再通过聚集索引找到对应的行数据</li>
</ul>
<p>当条件为id &#x3D; ？时，会比 name &#x3D; ？效率更高，因为id字段查找可以直接走聚集索引，不需要走二级索引找到其对应的id</p>
<h2 id="索引相关语句"><a href="#索引相关语句" class="headerlink" title="索引相关语句"></a>索引相关语句</h2><p>创建索引语句：CREATE [Unique&#x2F;FullText] INDEX index_name ON table_name(table_col_name1,……)</p>
<p><strong>当内部列名语句为多个时创建的是联合索引</strong></p>
<p>查看当前表索引：SHOW INDEX FROM table_name;</p>
<p>删除索引：DROP INDEX index_name ON table_name</p>
<h2 id="性能分析"><a href="#性能分析" class="headerlink" title="性能分析"></a>性能分析</h2><ul>
<li>查看执行语句频次</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show global status like &#x27;com_______&#x27;</span><br></pre></td></tr></table></figure>

<ul>
<li>慢查询日志</li>
<li>show variables like ‘slow_query_log’;查看慢查询是否开启</li>
</ul>
<p>​       在&#x2F;etc&#x2F;my.cnf中新增如下语句</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#慢查询日志</span><br><span class="line">slow_query_log = 1  //打开慢查询日志</span><br><span class="line"></span><br><span class="line">long_query_time = 2  //设置慢查询时间上限，即超过几秒为慢查询</span><br></pre></td></tr></table></figure>

<p>​      <strong>在&#x2F;var&#x2F;lib&#x2F;mysql文件夹下的localhost_slow文件中查看慢查询语句</strong></p>
<p>​      <strong>tail -f localhost_slow.log查看慢查询文件尾部实时输出的内容</strong></p>
<ul>
<li>ShowProfiles</li>
<li>帮我们了解时间都消耗到哪里去了，通过have_profiling参数能看到当前mysql是否支持showProfiles</li>
</ul>
<p>​	默认是关闭的，所以需要set profiling &#x3D; 1;去打开</p>
<ul>
<li>查看语句show profilies;</li>
</ul>
<p><img src="/2023/02/10/JavaWeb/Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20221019163125919.png" alt="image-20221019163125919"></p>
<ul>
<li>查看具体语句执行阶段消耗时间 show profile for query query_id;</li>
</ul>
<p><img src="/2023/02/10/JavaWeb/Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20221019163315971.png" alt="image-20221019163315971"></p>
<ul>
<li><strong>explain执行计划(重要)</strong></li>
<li>可以获取具体sql语句的连接情况和连接信息，是否应用了索引</li>
<li>语法：在任意select语句之前加入explain</li>
</ul>
<p><img src="/2023/02/10/JavaWeb/Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20221019165505924.png" alt="image-20221019165505924"></p>
<ul>
<li>id表示sql语句表的执行顺序，id值相同表示从上到下执行，id值不同越大的先执行</li>
<li>selectType表示查询的类型</li>
<li><strong>type表示访问的类型由好到坏依次是NULL , system , const , eq_ref , ref,  range , index , all也是主要需要优化的东西</strong></li>
<li><strong>一般不可能优化为NULL，因为NULL的条件是查询时不使用任何表，System一般访问系统表才会出现，根据主键或者唯一索引一般会出现const（聚集索引），ref表示使用非唯一性的索引进行查询，all表示全表扫描，index表示用了索引但对索引进行了遍历</strong></li>
<li><strong>possible_keys：表示可能用到的索引</strong></li>
<li><strong>key表示实际用到的索引</strong></li>
<li><strong>key_len使用到的索引的字节数</strong></li>
<li>rows表示必须要执行查询的行数</li>
<li><strong>filtered表示返回结果的行数占需要读取行数的百分比，越高越好</strong></li>
<li>extra其他没有展示的信息在这里展示</li>
</ul>
<h2 id="索引使用原则"><a href="#索引使用原则" class="headerlink" title="索引使用原则"></a>索引使用原则</h2><ul>
<li>最左前缀法则</li>
</ul>
<p>针对于联合索引，查询时需要从索引最左边的列开始，并且不跳过最左边的列，如果跳跃某一列，则会使这一列后面的索引失效，索引最左边的字段必须存在</p>
<p><img src="/2023/02/10/JavaWeb/Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20221019181020343.png" alt="image-20221019181020343"></p>
<p>当最左边profession条件没有出现时，就不会使用这个联合索引，因为没有遵循最左前缀法则</p>
<ul>
<li>范围查询</li>
</ul>
<p>在联合索引中，出现范围（&lt;,&gt;）查询，则出现范围查询的列的右侧索引失效,注意可以使用大于等于或小于等于</p>
<ul>
<li>索引失效情况1</li>
<li>当对索引字段进行函数运算，对应索引会失效</li>
</ul>
<p><img src="/2023/02/10/JavaWeb/Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20221019182419349.png" alt="image-20221019182419349"></p>
<ul>
<li>失效情况2</li>
<li>如果索引字段为varchar类型查询时没有加单引号则索引失效</li>
</ul>
<p><img src="/2023/02/10/JavaWeb/Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20221019183132630.png" alt="image-20221019183132630"></p>
<ul>
<li>失效情况3</li>
<li>如果模糊匹配时，仅仅是尾部模糊匹配  ‘软件%’ 不会失效，头部模糊匹配  ‘%15’  会失效</li>
</ul>
<p><img src="/2023/02/10/JavaWeb/Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20221019183046987.png" alt="image-20221019183046987"></p>
<ul>
<li>失效情况3</li>
<li>如果用or分割的条件，两侧都有索引时才会生效，否则都不会生效</li>
</ul>
<p><img src="/2023/02/10/JavaWeb/Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20221019183610472.png" alt="image-20221019183610472"></p>
<ul>
<li>失效情况4</li>
<li>如果在执行sql语句时，mysql评估使用索引比走全表扫描还慢，则会走全表扫描</li>
</ul>
<p><img src="/2023/02/10/JavaWeb/Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20221019183917703.png" alt="image-20221019183917703"></p>
<p>因为这张表绝大数据都满足这个条件，所以会走全表扫描，此时索引就会失效</p>
<ul>
<li>sql提示</li>
<li>当联合索引与单列索引都重复指定了一个字段时，需要自定一个sql提示去指定查询该字段时使用那个索引</li>
<li>具体语法以及使用效果</li>
</ul>
<p><img src="/2023/02/10/JavaWeb/Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20221019185325986.png" alt="image-20221019185325986"></p>
<ul>
<li>其中Use 使用某个索引， ingore不要使用某个索引，force必须使用某个索引，其中use可能也不会使用该索引，仅仅是建议</li>
</ul>
<h2 id="覆盖索引和回表查询"><a href="#覆盖索引和回表查询" class="headerlink" title="覆盖索引和回表查询"></a>覆盖索引和回表查询</h2><p>覆盖索引指，当需要查询的数据都能在索引中找到，尽量使用覆盖索引，减少使用select *语句</p>
<p><img src="/2023/02/10/JavaWeb/Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20221019192601260.png" alt="image-20221019192601260"></p>
<p>注意两个语句查询的内容以及表中的extra</p>
<p>当使用了覆盖查询时效率会高，因为不需要使用回表查询，查询的数据在索引中就能找到</p>
<h2 id="前缀索引"><a href="#前缀索引" class="headerlink" title="前缀索引"></a>前缀索引</h2><p>当字段类型为字符串时，有时候需要索引很长的字符串，这就会导致字符串的索引很大，查询时，浪费大量磁盘的IO,影响查询效率。此时可以将字符串的一部分前缀建立成索引，可以节省索引的空间，提高效率</p>
<ul>
<li>CREATE INDEX index_name ON table_name(colunm_name(n));</li>
</ul>
<p>索引的长度n由选择性决定，即不重复的值在所有值中占的比重，越大越好，如唯一索引的选择性即为1</p>
<p>计算索引的选择性语句</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select count(distinct substring(email,1,10))/count(*) from tb_user;</span><br></pre></td></tr></table></figure>

<p>可以不断改变截取的长度，根据需求觉得是取选择性高的还是在保证选择性的前提下尽可能空间小</p>
<h2 id="索引设计原则"><a href="#索引设计原则" class="headerlink" title="索引设计原则"></a>索引设计原则</h2><ol>
<li>数据量比较大的表</li>
<li>查询比较频繁的表</li>
<li>针对常作于查询条件，即经常出现在where，orderby，groupby的字段建立索引</li>
<li>尽量选择区分度高的列作为索引，尽量建立唯一索引，区分度越高，使用索引效率越高</li>
<li>如果是字符串类型的字段，且字符串长度很长，可以考虑前缀索引</li>
<li>尽量使用联合索引，减少使用单列索引，注意最左前缀法则</li>
<li>要控制索引的数量，索引的数量越多，增删改的效率越低，并且维护索引的代价也会增大</li>
<li>如果索引列不能存储null值，建表时请用not null约束字段，当优化器知道每列是否包含null值时，可以更好的确定哪个索引最有效的用于查询</li>
</ol>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><ul>
<li>当多信息查询时，推荐建立一个联合索引，移除回表查询步骤，提高效率，当有单列索引干扰时，要使用use指定语句使用哪个索引</li>
</ul>
<h2 id="SQL其他语句优化"><a href="#SQL其他语句优化" class="headerlink" title="SQL其他语句优化"></a>SQL其他语句优化</h2><h3 id="Insert优化"><a href="#Insert优化" class="headerlink" title="Insert优化"></a>Insert优化</h3><ol>
<li>大量数据插入，建议使用批量插入</li>
<li>建议使用手动事务提交，避免频繁开关事务，性能降低</li>
<li>主键顺序插入性能高于乱序插入</li>
</ol>
<p>大批量数据插入建议使用load指令</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mysql -u root -p --local-infile;  //表示当前客户端连接服务器时需要加载本地文件</span><br><span class="line">set global local_infile = 1; //设置允许本地文件读取</span><br><span class="line">load data local infile &#x27;文件名&#x27; into table 表名 fields terminated by &#x27;,&#x27; lines terminated by &#x27;\n&#x27;;</span><br></pre></td></tr></table></figure>

<h3 id="主键优化"><a href="#主键优化" class="headerlink" title="主键优化"></a>主键优化</h3><ul>
<li>数据组织方式</li>
</ul>
<p>在InnoDB引擎中，表数据都是根据表的<strong>主键顺序</strong>组织存放的，这种存储方式被称为索引组织表</p>
<ul>
<li>插入数据的流程</li>
</ul>
<p>页可以为空，也可以填充一半，也可以填充百分之百。每个页包含了2-N个数据（如果某一行数据过大，会行溢出），根据主键排列；</p>
<p><img src="/2023/02/10/JavaWeb/Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20221020172541968.png" alt="image-20221020172541968"></p>
<p>当主键乱序插入时，会发生页分裂</p>
<ul>
<li>当数据50插入时，应插在47后，但1号数据页已满，则会开辟一个新的3号数据页，将一号数据页的百分之50放到3号数据页中，将50存入3号数据页，再将1号数据页的链表指针指向3号，与3号形成双向链表，3号再指向2号</li>
</ul>
<p><img src="/2023/02/10/JavaWeb/Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20221020172915664.png" alt="image-20221020172915664"></p>
<ul>
<li>页合并</li>
</ul>
<p>当对数据进行删除，该数据实际上并没有在页中被删除，只是被标识为被删除，并将它的空间声明允许被其他数据使用，</p>
<p><img src="/2023/02/10/JavaWeb/Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20221020173131277.png" alt="image-20221020173131277"></p>
<p>当一页记录被删除了百分之50后，InnoDB会自动寻找靠近的页是否有合并的可能性，以优化空间使用</p>
<p><img src="/2023/02/10/JavaWeb/Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20221020173252720.png" alt="image-20221020173252720"></p>
<p>MERGE_THRESHOLD:为默认页合并阈值，可以自行设置</p>
<ul>
<li>主键设计原则</li>
</ul>
<ol>
<li>尽量降低主键长度，当主键长度过长时，会使二级索引占用大量空间，浪费磁盘IO</li>
<li>插入数据时尽量主键顺序插入，选择使用AUTO_INCREMENT自增主键</li>
<li>尽量不要使用UUID做主键或者其他自然主键，如身份证号</li>
<li>业务操作时，避免对主键的修改</li>
</ol>
<h3 id="OrderBy优化"><a href="#OrderBy优化" class="headerlink" title="OrderBy优化"></a>OrderBy优化</h3><ol>
<li>Using FileSort：通过索引或者全表扫描读取到的数据，被放到排序缓冲区中，经过排序缓冲区排序后在输出，所有不是由索引直接返回排序的结果都叫 Using FileSort</li>
<li>Using Index：通过有序索引直接返回有序数据，这种叫做 Using Index，不需要额外排序，操作效率高</li>
</ol>
<ul>
<li><p>尽量给需要用OrderBy排序的字段建立一个索引，提高效率</p>
</li>
<li><p>当使用orderBy操作的字段违背了最左前缀法则，也会出现FileSort，效率低</p>
</li>
<li><p>创建索引时默认是升序排序，当排序的两个字段一个为升序，一个为降序，仍会出现FileSort，效率较低，若需要这种校验规则，<strong>则需要创建索引时指定字段的排序规则</strong></p>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">create index idx_user_phone_age_ad on tb_user(phone asc,age desc );</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>注意，所有OrderBy优化条件的前提是使用了覆盖索引，否则就会一直使用FileSort</strong></li>
<li>如果不可避免的出现FileSort，再大数据量排序时，可以将排序缓冲区(sort_buffer_size)的大小扩大(默认256K)，否则Mysql会在磁盘中进行排序，效率低</li>
</ul>
<h3 id="GroupBy优化"><a href="#GroupBy优化" class="headerlink" title="GroupBy优化"></a>GroupBy优化</h3><p>整体与其他大致相同，也要满足最左前缀法则</p>
<p><strong>但当where后出现了最左前缀，GroupBy后出现了另外的字段，则也满足最左前缀法则</strong></p>
<h3 id="Limit优化"><a href="#Limit优化" class="headerlink" title="Limit优化"></a>Limit优化</h3><p>越往后效率越低，当查到第5000多页后效率明显低下</p>
<p>优化方法：覆盖索引+子查询的方式</p>
<p>先分页查询查询对应的ID(覆盖查询)</p>
<p>将查到的对应ID的表作为查询的表条件，再消除笛卡尔积(子查询)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from tb_sku s ,(select id from tb_sku limit 900000,10) a where s.id = a.id;</span><br></pre></td></tr></table></figure>

<h3 id="Count优化"><a href="#Count优化" class="headerlink" title="Count优化"></a>Count优化</h3><ul>
<li>MyISAM把一个表的总行数放到了磁盘中，count的时候会直接返回这个数，效率很高</li>
<li>InnoDB则需要把数据一行一行的从磁盘里取出来计数</li>
</ul>
<p>优化思路，自己计数</p>
<p>当我们执行插入数据时，把计数加一，删除数据时再减一，自己去维护这个计数</p>
<ul>
<li><p>Count的几种用法</p>
</li>
<li><p>count(*) 效率最高</p>
</li>
</ul>
<p>不取值，服务层直接按行累加（专门做过优化）</p>
<ul>
<li>count(主键) 效率中等</li>
</ul>
<p>遍历每一张表，把每一行的主键id值提取出来，返回给服务层，服务层拿到主键后进行累加</p>
<ul>
<li>count(字段)  ：只要count的数据不是NULL，就加一，效率最差</li>
</ul>
<p>有Not Null约束：遍历表，把每一行的字段值提取出来，返回给服务层，服务层拿到值后累加</p>
<p>没有Not NULL约束：同上，但会判断是否为Null，为Null则不累加</p>
<ul>
<li>count(1)：所查询的每一条记录都会放一个1进去，然后在后端进行累加，与count*差不多</li>
</ul>
<p>遍历整张表，不取值，服务层对于返回的每一行都会放一个1进去，然后进行累加</p>
<h3 id="Update优化"><a href="#Update优化" class="headerlink" title="Update优化"></a>Update优化</h3><p>避免行锁升级为表锁</p>
<p>一定要对where后面的字段建立索引，否则行锁会升级为表锁，阻止事物的并发</p>
<p>InnoDB中行锁是针对索引加的锁，不是针对记录加的锁，一定要保证索引不能失效，否则行锁会升级成表锁</p>
<h2 id="视图"><a href="#视图" class="headerlink" title="视图"></a>视图</h2><p>创建语法</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">create or replace view stu_v1 as select id,name from student where id&lt;=20 with cascaded check option;</span><br><span class="line">创建一个视图，以....select语句为表，with cascaded check option表示若增删改的数据不符合创建视图的select语句的范围，则会报错，因为插入数据后视图看不到该数据</span><br></pre></td></tr></table></figure>

<ul>
<li>删除视图</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Drop view 视图名称1,视图名称2....</span><br></pre></td></tr></table></figure>

<ul>
<li>修改视图与创建视图语法相同</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">create or replace view stu_v1 as select id,name from student where id&lt;=10 with cascaded check option; </span><br></pre></td></tr></table></figure>

<ul>
<li><p>增删改查语法与表相同，视图可以看作一个虚拟的表</p>
</li>
<li><p>进行增删改时，也会在原表上进行增删改</p>
</li>
<li><p>当根据一个视图创建另一个子视图时，加上with cascaded check option ,会检查当前视图是否满足父视图的要求，并且会默认为父视图加上with cascaded check option级联关键字</p>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">create or replace view stu_v2 as select id,name from stu_v1 where id &gt;= 10 with cascaded check option ;</span><br><span class="line">insert into stu_v2 values (7,&#x27;Tom&#x27;);</span><br><span class="line">insert into stu_v2 values (26,&#x27;Tom&#x27;);</span><br></pre></td></tr></table></figure>

<p>两条插入语句都会失败，虽然26大于10，但是26小于父表的20，所以不行</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">create or replace view stu_v3 as select id,name from stu_v2 where id &lt;= 15;</span><br><span class="line">insert into stu_v3 values (17,&#x27;Tom&#x27;);//可以插入</span><br><span class="line">insert into stu_v3 values (28,&#x27;Tom&#x27;);//报错</span><br></pre></td></tr></table></figure>

<ul>
<li><p>插入17时，因为V3没有加check option，所以不会检查v3视图，继续向上检查v2视图，满足条件，向上检查v1视图满足条件，可以插入</p>
</li>
<li><p>插入28时，同理，但不满足v1的条件，所以插入失败</p>
</li>
<li><p>with local check option 会对当前视图进行校验，<strong>在看他的依赖视图是否有检查选项，如果没有检查选项则不检查(与cascaded关键字的不同点)</strong></p>
</li>
</ul>
<p><strong>要使视图可更新，必须使视图的行与基础表的行为一对一的关系</strong></p>
<ul>
<li>视图的作用</li>
</ul>
<ol>
<li>操作简单，简化用户对于数据的理解</li>
<li>安全。数据库可以授权，但不能授权到特定的行或者列上。通过视图用户可以只查询和更改某些特定数据</li>
<li>数据独立。视图可以帮助用户屏蔽真实表结构带来的变化，若表的列名变化，只需要修改创建视图的语句即可</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">create or replace view stu_v1 as select student.id,student.name,student.no,course.name as &#x27;课程名称&#x27; from student,course,student_course where student.id = student_course.studentid and course.id = student_course.courseid with cascaded check option;</span><br><span class="line"></span><br><span class="line">select * from stu_v1 where name = &#x27;黛绮丝&#x27;;</span><br></pre></td></tr></table></figure>

<p>通过视图简化多表查询作用以及屏蔽隐私字段</p>
<h2 id="存储过程"><a href="#存储过程" class="headerlink" title="存储过程"></a>存储过程</h2><p>指事先经过编译，存储在数据库的一段sql指令集合，减少数据在数据库和应用服务器之间的传输，可以减少网络交互，提升效率</p>
<h3 id="基本语法"><a href="#基本语法" class="headerlink" title="基本语法"></a>基本语法</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">create procedure p1() //创建过程</span><br><span class="line">begin</span><br><span class="line">    select count(*) from student;</span><br><span class="line">end;</span><br><span class="line"></span><br><span class="line">call p1();  //调用过程</span><br><span class="line"></span><br><span class="line">select * from information_schema.ROUTINES where ROUTINE_SCHEMA = &#x27;MysqlHigh&#x27;;//查看当前表中所有过程</span><br><span class="line"></span><br><span class="line">show create procedure p1; //查看p1的创建语法</span><br><span class="line"></span><br><span class="line">drop procedure p1;  //删除p1集合</span><br></pre></td></tr></table></figure>

<p>注意在命令行中执行，会认为p1方法体内的分号为结束符号，创建会报错，要自定义一个结束符号</p>
<p>delimiter  $$;</p>
<p>表示设置$$为结束命令符</p>
<p><img src="/2023/02/10/JavaWeb/Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20221021124019005.png" alt="image-20221021124019005"></p>
<h3 id="系统变量"><a href="#系统变量" class="headerlink" title="系统变量"></a>系统变量</h3><p>是系统提供的，不是用户定义的，属于服务器层面，分为全局变量global和会话变量session</p>
<ul>
<li>全局变量：全局都有效</li>
<li>会话变量：仅在当前会话有效</li>
</ul>
<p>具体语法</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">show global variables like &#x27;Auto%&#x27;; //查看系统变量利用模糊匹配</span><br><span class="line"></span><br><span class="line">show global variables like &#x27;local_infile&#x27;; </span><br><span class="line"></span><br><span class="line">select @@local_infile; //根据准确系统变量名查看对应的值 select @@global/session.local_inifile</span><br><span class="line"></span><br><span class="line">set @@session/global.local_infile = 1;  //设置对应系统变量的值</span><br><span class="line"></span><br><span class="line">set session/global local_infile = 1 ;</span><br></pre></td></tr></table></figure>

<p>设置系统变量后，将mysql服务器重启，对应系统变量还是会重置成默认值</p>
<h3 id="用户自定义变量"><a href="#用户自定义变量" class="headerlink" title="用户自定义变量"></a>用户自定义变量</h3><p>用户变量不需要提前声明，设置时直接@变量名设置就可以</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">set @My_Name = &#x27;MysqlHigh&#x27;;</span><br><span class="line"></span><br><span class="line">set @My_Age := &#x27;myage&#x27;;</span><br><span class="line"></span><br><span class="line">select @My_Gender := &#x27;男&#x27; ,@MyHobby := &#x27;Java&#x27;;</span><br><span class="line"></span><br><span class="line">select count(*) into @My_Count from student ; 将指定语句的查询结果赋值给变量</span><br><span class="line"></span><br><span class="line">select @My_Count;  查看对应变量</span><br></pre></td></tr></table></figure>

<h3 id="局部变量"><a href="#局部变量" class="headerlink" title="局部变量"></a>局部变量</h3><p>需要提前声明，范围在其声明的 begin 和 end块</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">create procedure p2()</span><br><span class="line">begin</span><br><span class="line">    declare stu_count int default 0; //声明变量</span><br><span class="line"></span><br><span class="line">    set stu_count := 100; //赋值方法1</span><br><span class="line"></span><br><span class="line">    select count(*) into stu_count from student; //赋值方法2</span><br><span class="line"></span><br><span class="line">    select stu_count;</span><br><span class="line">end;</span><br></pre></td></tr></table></figure>

<h3 id="存储过程的参数"><a href="#存储过程的参数" class="headerlink" title="存储过程的参数"></a>存储过程的参数</h3><p>（IN  , OUT , INOUT）</p>
<ul>
<li>IN代表输入参数，默认为in类型参数</li>
<li>OUT代表输出参数</li>
<li>INOUT表示当前传入的参数既可以当作输入参数，又可以当做输出参数</li>
<li>声明方法 :  <strong>IN&#x2F;OUT&#x2F;INOUT  变量名  变量类型</strong></li>
</ul>
<h3 id="If基本语法"><a href="#If基本语法" class="headerlink" title="If基本语法"></a>If基本语法</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">create procedure p3(In score int,OUT result varchar(5))</span><br><span class="line">begin</span><br><span class="line">    if Score &gt;= 85 then set   //开启if判断</span><br><span class="line">        Result := &#x27;优秀&#x27;;</span><br><span class="line">    elseif Score &gt;=60 and Score &lt;85 then set</span><br><span class="line">        Result := &#x27;及格&#x27;;</span><br><span class="line">    elseif Score &lt;60 then set</span><br><span class="line">        Result := &#x27;不及格&#x27;;</span><br><span class="line">    end if;                  //关闭if判断</span><br><span class="line">end;</span><br><span class="line"></span><br><span class="line">call p3(85,@result);    //调用方法，将返回值赋给@result</span><br><span class="line">SELECT @result;  //输出自定义变量@result</span><br></pre></td></tr></table></figure>

<h3 id="Case语法"><a href="#Case语法" class="headerlink" title="Case语法"></a>Case语法</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">create procedure p4(IN SESSION INT,OUT RESULT VARCHAR(5))</span><br><span class="line">BEGIN </span><br><span class="line">    case   //开启case</span><br><span class="line">        when SESSION&gt;=1 and SESSION &lt;=3 then set RESULT = &#x27;春天&#x27;;</span><br><span class="line">        when SESSION&gt;=4 and SESSION &lt;=6 then set RESULT = &#x27;夏天&#x27;;</span><br><span class="line">        when SESSION&gt;=7 and SESSION &lt;=9 then set RESULT = &#x27;秋天&#x27;;</span><br><span class="line">        when SESSION&gt;=10 and SESSION &lt;=12 then set RESULT = &#x27;冬天&#x27;;</span><br><span class="line">        ELSE SET RESULT = &#x27;月份有误&#x27;;</span><br><span class="line">        end case ;  //结束case</span><br><span class="line">end;</span><br><span class="line">call p4(10,@RESULT);</span><br><span class="line">select @RESULT;</span><br></pre></td></tr></table></figure>

<h3 id="循环结构"><a href="#循环结构" class="headerlink" title="循环结构"></a>循环结构</h3><ul>
<li>WHILE循环：有条件的循环控制语句</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">create procedure p5(in n int)</span><br><span class="line">begin</span><br><span class="line">    declare m int default 1;</span><br><span class="line">    while n do            //n不为0时继续循环</span><br><span class="line">        set m := m+m+1;</span><br><span class="line">        set n := n-1;</span><br><span class="line">        end while;</span><br><span class="line">    select m,n;</span><br><span class="line">end;</span><br><span class="line">call p5 (10);</span><br></pre></td></tr></table></figure>

<ul>
<li>Repeat循环：先执行一次再判断，类比DO WHILE</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">create procedure p6(in n int)</span><br><span class="line">begin</span><br><span class="line">    declare m int default 1;</span><br><span class="line">    repeat</span><br><span class="line">        set m := m + m + 1;</span><br><span class="line">        set n := n-1;</span><br><span class="line">    until n = 0 end repeat;</span><br><span class="line">    select m;</span><br><span class="line">end;</span><br><span class="line">call p6(10);</span><br></pre></td></tr></table></figure>

<ul>
<li>loop循环</li>
</ul>
<ol>
<li>Leave  循环标签 ：配合循环使用，表明退出哪个循环</li>
<li>Iterate  循环标签 ：表示跳过当前循环剩下的语句，继续下一次循环</li>
</ol>
<p>不加任何退出循环条件，可以实现简单的死循环</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">create procedure p7(in n int)</span><br><span class="line">begin</span><br><span class="line">    declare m int default 1;</span><br><span class="line">    lable1 :loop   //为loop设置循环标签为lable1</span><br><span class="line">        set m := m+m+1;</span><br><span class="line">        set n := n-1;</span><br><span class="line">        if n = 0 then leave lable1 ;</span><br><span class="line">        end if;</span><br><span class="line">    end loop lable1;</span><br><span class="line">    select m;</span><br><span class="line">end;</span><br><span class="line"></span><br><span class="line">call p7(10);</span><br><span class="line">--------------------------------------------------------------------------------------------</span><br><span class="line">create procedure p8(in n int)</span><br><span class="line">begin</span><br><span class="line">    declare m int default 0;</span><br><span class="line">    lable2 : loop</span><br><span class="line">        if n%2=1 then</span><br><span class="line">            set n = n-1;</span><br><span class="line">            iterate lable2;   //跳过lable2循环</span><br><span class="line">        end if;</span><br><span class="line">        set m := m + n;</span><br><span class="line">        set n = n - 1;</span><br><span class="line">        if n &lt;= 0 then leave lable2;</span><br><span class="line">        end if;</span><br><span class="line">    end loop lable2;</span><br><span class="line">    select m;</span><br><span class="line">end;</span><br><span class="line"></span><br><span class="line">call p8(10);</span><br></pre></td></tr></table></figure>

<h3 id="游标cursor"><a href="#游标cursor" class="headerlink" title="游标cursor"></a>游标cursor</h3><p>解决再存储过程中自定义变量只能存储一些int，varchar类型的问题，用来存储表</p>
<p>游标的使用包括</p>
<ol>
<li>游标的声明</li>
<li>游标的开启</li>
<li>游标对数据的获取</li>
<li>游标的关闭</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">create procedure p9(in uage int)</span><br><span class="line">begin</span><br><span class="line">    declare u_name varchar(10);</span><br><span class="line">    declare u_pro varchar(10);</span><br><span class="line">    declare table1 cursor for select name,profession from tb_user1 where age &lt; uage; </span><br><span class="line">    //游标一定要声明再局部变量之后</span><br><span class="line">    declare EXIT handler for SQLSTATE &#x27;02000&#x27; close table1; //条件处理程序</span><br><span class="line">    create table tb_user_pro(</span><br><span class="line">        id int primary key auto_increment ,</span><br><span class="line">        name varchar(10) ,</span><br><span class="line">        profession varchar(10)</span><br><span class="line">    );</span><br><span class="line">    open table1;   //打开游标</span><br><span class="line">    while true do</span><br><span class="line">        fetch table1 into u_name,u_pro;</span><br><span class="line">        insert into tb_user_pro(name , profession) values (u_name,u_pro);</span><br><span class="line">end while;</span><br><span class="line">end;</span><br><span class="line">call p9(40);</span><br></pre></td></tr></table></figure>

<p>条件处理程序：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">declare EXIT handler for SQLSTATE &#x27;02000&#x27; close table1;</span><br></pre></td></tr></table></figure>

<ul>
<li>负责解决再流程处理条件中遇到的问题</li>
<li>例子中EXIT为当捕捉到02000错误码时执行退出循环，并close table1，可以被更换为CONTINUE</li>
<li>后面的SQLSTATE表示要捕捉的状态码</li>
<li>可以换成</li>
<li>NOT FOUND  表示任何以02开头的状态码</li>
<li>SQL WARING  表示任何以01开头的状态码</li>
<li>SQLSTATE state_value :表示状态码等于后面的值  </li>
<li>SQLEXCEPTION ：任何除了01，02开头的状态码</li>
</ul>
<h3 id="存储函数"><a href="#存储函数" class="headerlink" title="存储函数"></a>存储函数</h3><p>存储函数是有返回值的函数，形参只能是IN类型的</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">create FUNCTION SUM1(n int) //表明传入参数名称，类型</span><br><span class="line">RETURNS int NO SQL  //指定返回的参数类型，characterstic特性</span><br><span class="line">BEGIN</span><br><span class="line">    declare m int default 0;</span><br><span class="line">    while n do</span><br><span class="line">    set m := m + n;</span><br><span class="line">    set n := n - 1;</span><br><span class="line">    end while ;</span><br><span class="line">    return m;    //返回m</span><br><span class="line">end;</span><br><span class="line">select SUM1(10);  //调用存储函数</span><br></pre></td></tr></table></figure>

<p><strong>Characteristic特性</strong></p>
<ul>
<li>NO SQL：返回的结果不包含sql语句</li>
<li>DETERMINISTIC：相同的输入参数 总是产生相同的结果</li>
<li>READ SQL DATE：包含读取数据的语句，不包含写入数据的语句</li>
</ul>
<h2 id="触发器"><a href="#触发器" class="headerlink" title="触发器"></a>触发器</h2><p>指在增删改之前或者之后，触发，并执行触发器中指定的sql语句集合。根据这种特性，我们可以在数据库中完成数据库的数据保证，记录日志</p>
<p>触发器类型</p>
<ul>
<li>INSERT类型：NEW表示将要或者已经新增的数据</li>
<li>DELETE类型：OLD表示将要或者已经删除的数据</li>
<li>UPDATE类型：OLD表示修改之前的数据，NEW表示修改之后的数据</li>
</ul>
<p>都是行级触发器，指一条语句影响了5行数据，则触发器触发5次（MYSQL只支持此类触发器）</p>
<p>语句级触发器则不管一条语句影响了多少个数据，一条语句只触发一次触发器</p>
<p>创建语法：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">create trigger tb_user1_insert_tri </span><br><span class="line">	after/begin insert/update/delete on tb_user1 FOR EACH ROW</span><br><span class="line">    begin</span><br><span class="line">        insert into user_logs     			values(null,&#x27;insert&#x27;,now(),new.id,concat(new.id,new.name,NEW.email,NEW.profession,NEW.age,NEW.gender,NEW.status,NEW.createtime));</span><br><span class="line">    end;</span><br><span class="line">    </span><br><span class="line">drop trigger tb_user1_insert_tri;  //删除触发器</span><br><span class="line"></span><br><span class="line">show triggers ;  //查看触发器</span><br></pre></td></tr></table></figure>

<p>内部有类似事务的原理，当触发器报错时，所执行的任何insert语句都不会成功执行</p>
<h2 id="锁"><a href="#锁" class="headerlink" title="锁"></a>锁</h2><h3 id="全局锁"><a href="#全局锁" class="headerlink" title="全局锁"></a>全局锁</h3><p>一般用于对数据库进行备份的环节，为数据库中的所有表上锁，只允许读操作，不允许写操作</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">flush tables with read lock ; 加锁</span><br><span class="line">unlock tables; 解锁</span><br></pre></td></tr></table></figure>

<p>数据备份指令:要在CMD窗口上运行</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqldump -uroot -p1234 database_name &gt; 要保存的路径</span><br></pre></td></tr></table></figure>

<p>若要连接别的主机上的数据库，要加上-h 主机IP地址</p>
<ul>
<li>在从库当中进行备份，可以进行写操作，但是不能接受主库传来的二进制日志，会导致主从延迟</li>
</ul>
<h3 id="表级锁"><a href="#表级锁" class="headerlink" title="表级锁"></a>表级锁</h3><h4 id="表锁"><a href="#表锁" class="headerlink" title="表锁"></a>表锁</h4><ul>
<li><p>表共享读锁（读锁）：所有客户端都可以读，但是所有客户端都不能写</p>
</li>
<li><p>表独占写锁（写锁）：加锁的客户端既能读又能写，别的客户端不能读也不能写</p>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lock tables student read/write;</span><br></pre></td></tr></table></figure>

<p>解锁：unlock tables或断开连接</p>
<h4 id="元数据锁（MDL）"><a href="#元数据锁（MDL）" class="headerlink" title="元数据锁（MDL）"></a>元数据锁（MDL）</h4><p>是系统自动控制的，当我们访问一张表时，表会自动加锁，元数据可以看作是表结构，元数据锁存在的意义是维护表结构的一致性，当有活动事务存在时，是不允许对元数据进行操作。<strong>避免DDL,DML语句的冲突，保证读写的正确性</strong></p>
<p><img src="/2023/02/10/JavaWeb/Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20221021192940985.png" alt="image-20221021192940985"></p>
<p>增删改查之间的锁互相兼容，但与DDL语句的EXCLUSIVE排他锁互相排斥</p>
<p>兼容即，有共享读锁也可以进行增删改操作</p>
<h4 id="意向锁"><a href="#意向锁" class="headerlink" title="意向锁"></a>意向锁</h4><p>为了避免在执行DML语句时所加的行锁与表锁的冲突，加入了意向锁，使加表锁时不用检查每一行数据是否加了行锁</p>
<p>优化过程</p>
<p><img src="/2023/02/10/JavaWeb/Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20221021194537665.png" alt="image-20221021194537665"></p>
<p>左侧开启事务执行update语句加了行锁后，会加上一个意向锁，线程B在为表加锁时会直接检查意向锁以及意向锁的类型，如果兼容就加锁，互斥就变为阻塞状态，等左侧事务提交后再加锁</p>
<ul>
<li>意向共享锁IS；与表锁共享读锁兼容，与表锁独占写锁互斥</li>
</ul>
<p>由select……lock in share mode语句添加</p>
<ul>
<li>意向排他锁IX：与表锁共享读，表锁独占写锁都互斥</li>
</ul>
<p>由update ，insert ，delete ，select ……for update语句添加</p>
<h3 id="行级锁"><a href="#行级锁" class="headerlink" title="行级锁"></a>行级锁</h3><p>行锁时通过对索引上的索引项来加锁的，若执行语句时没有索引存在，则会变成表锁</p>
<ul>
<li>行锁：防止其他事务对其进行update，delete操作，再RC,RR隔离级别下都支持</li>
<li>间隙锁：锁定两个索引记录之间的间隙，防止其他事务进行insert操作，从而产生幻读现象，在RR级别下支持</li>
<li>临键锁：行锁和间隙锁的合成，同时锁住数据，以及数据前的间隙，在RR级别下支持</li>
</ul>
<p><img src="/2023/02/10/JavaWeb/Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20221021200732033.png" alt="image-20221021200732033"></p>
<p>行锁的两种类型</p>
<ul>
<li>共享锁 S：允许一个事务去读一行，组织其他事务获得相同数据的排他锁</li>
</ul>
<p>概括：共享锁之间互相兼容，共享锁与排他锁不兼容</p>
<ul>
<li>排他锁 X：允许获取排他锁的事务更新数据，但阻止其他事务获取相同数据集的排他锁和共享锁</li>
</ul>
<p>概括：排他锁与其他排他锁，共享锁都不兼容，一种悲观锁</p>
<p>加共享锁的语句:select ….. lock in share mode</p>
<p>排他锁: update , delete , insert , select …. for update</p>
<p>注意：select语句本身不加任何锁，规律与意向锁相同</p>
<hr>
<p><strong>InnoDB默认事务隔离权限是RR，所以默认使用临建锁去遍历，将数据本身与数据之前的空隙全部上锁，防止幻读</strong></p>
<ul>
<li>针对唯一索引进行检索时，针对已存在的记录进行等值匹配时，会自动优化为行锁</li>
<li>针对索引进行等值检索时（唯一索引），针对不存在的记录加锁时，会变成一个间隙锁</li>
</ul>
<p><strong>锁的间隙是这个不存在的记录应该在的位置的间隙</strong></p>
<ul>
<li>针对索引进行等值检索时（普通索引），向右遍历时最后一个值不满足查询需求时，临键锁退化成间隙锁</li>
</ul>
<p><img src="/2023/02/10/JavaWeb/Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20221021211436463.png" alt="image-20221021211436463"></p>
<ul>
<li>针对索引的范围查询（唯一索引），会一直遍历到第一个不属于范围的值为止，此时也会退化成间隙锁</li>
<li>遍历ID小于40的数据</li>
</ul>
<p><img src="/2023/02/10/JavaWeb/Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20221021211636112.png" alt="image-20221021211636112"></p>
<p><strong>间隙锁的目的就是防止insert插入，造成幻读现象，多个事务的间隙锁可以锁住同一个间隙</strong></p>
<h2 id="InnoDB引擎底层"><a href="#InnoDB引擎底层" class="headerlink" title="InnoDB引擎底层"></a>InnoDB引擎底层</h2><h3 id="逻辑存储结构"><a href="#逻辑存储结构" class="headerlink" title="逻辑存储结构"></a>逻辑存储结构</h3><p><img src="/2023/02/10/JavaWeb/Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20221022143719234.png" alt="image-20221022143719234"></p>
<ul>
<li>表空间：一个mysql实例可以对应多个表空间:IBD文件</li>
<li>段：数据段：B+树的叶子节点集合，索引段：非叶子节点集合，回滚段</li>
<li>区：每个区大小为1M，最多可以存64个页</li>
<li>页：InnoDB存储引擎磁盘的最小单元，每个页为16kb，每个页都是一个B+树的结点</li>
<li>行：引擎存放的数据  </li>
<li>Trx_id:记录上次事务执行的id</li>
<li>Roll_Pointer：记录操作之前对应的数据</li>
</ul>
<h3 id="内存结构"><a href="#内存结构" class="headerlink" title="内存结构"></a>内存结构</h3><p><img src="/2023/02/10/JavaWeb/Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20221022131955079.png" alt="image-20221022131955079"></p>
<ul>
<li>Buffer Pool：缓冲池</li>
</ul>
<p>是主内存的一块区域，可以缓存磁盘经常操作的一些数据，进行增删改查操作时，会先操作这里的数据（没有数据则从磁盘加载数据），再以一定的频率将缓冲区的数据刷到磁盘中，减少磁盘IO，加快处理速度</p>
<p>缓冲池以页为单位，底层采用链表结构管理page单位</p>
<ol>
<li>freepage：申请了空间，但还没有数据</li>
<li>cleanpage：存入了数据，但还没被修改</li>
<li>dirty page:修改了数据，还没被刷到磁盘上，数据与磁盘上的不同</li>
</ol>
<ul>
<li>Change Buffer：更改缓冲区（针对非唯一 ，二级索引）</li>
</ul>
<p>在执行DML语句时，数据页在bufferpool中不存在的话，会将数据的变更存在change buffer中，等buffer pool读取到对应的数据，再将change buffer里的数据与buffer pool的数据合并，再刷到磁盘上</p>
<ul>
<li>Log Buffer</li>
</ul>
<p>用来保存要写到磁盘中的log日志文件（redo log，undo log），默认大小为16M，会定期的进行磁盘的刷新，如果需要批量的增删改操作，加大logbuffer的空间可以节省磁盘io</p>
<ul>
<li>Adaptive Hash Index(自适应哈希)</li>
</ul>
<p>用于优化buffer pool对数据的查询。如果系统发现hash索引可以提高速度，则会自动建立一个hash索引</p>
<h3 id="磁盘结构"><a href="#磁盘结构" class="headerlink" title="磁盘结构"></a>磁盘结构</h3><p><img src="/2023/02/10/JavaWeb/Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20221022132005729.png" alt="image-20221022132005729"></p>
<ul>
<li>System TableSpace</li>
</ul>
<p>是changebuffer的主要存放区域，也可能包含表和索引数据（独立系统表空间若没开启）</p>
<ul>
<li>File-Per-Table Tablespaces</li>
</ul>
<p>如果innodb_file_per_table &#x3D; on（默认开启） ， 则每个表的表空间文件包含索引和数据，存储在文件系统上的单个数据文件上</p>
<ul>
<li>General TableSpaces：通用表空间</li>
</ul>
<p>需要用create tablespace创建，在创建文件时指定存储什么表空间文件，或者再创建表时指定存储的通用表空间</p>
<ul>
<li>Undo TableSpaces：撤销表空间</li>
</ul>
<p>主要存储Undo log，有两个大小相同的表空间undo_001,undo_002</p>
<ul>
<li>Temporary TableSpaces：临时表空间</li>
</ul>
<p>存储临时表</p>
<ul>
<li>RedoLog：循环使用ib_logfile0,ib_logfile1，不会永久保存</li>
</ul>
<p>重做日志，用来保证事务的持久性，包含两个文件：重做日志缓冲redo log buffer，重做日志文件redo log file,前者在内存中，后者在磁盘中。当事务提交后会把所有信息都存放在redolog文件中，用于在刷新脏页到磁盘中，发生错误时，进行恢复</p>
<ul>
<li>DoubleWrite Buffer Files</li>
</ul>
<p>当BufferPool将数据刷到磁盘上时，会优先刷到双写缓冲区中，便于系统异常时恢复数据</p>
<h3 id="后台线程"><a href="#后台线程" class="headerlink" title="后台线程"></a>后台线程</h3><p>将innoDB存储引擎中的缓冲池的数据在合适的时机刷到磁盘中</p>
<p><img src="/2023/02/10/JavaWeb/Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20221022134053744.png" alt="image-20221022134053744"></p>
<ul>
<li>Master Thread：核心线程</li>
</ul>
<p>主要用于调度其他线程，还负责将缓冲池的数据异步刷新到磁盘当中，保证一致性，还包括脏页的刷新，合并插入缓存，undolog的回收</p>
<ul>
<li>IO Thread：IO线程</li>
</ul>
<p>采用的是AIO，异步非阻塞IO，可以极大的提升数据库的性能，该线程主要负责这些IO请求的回调</p>
<table>
<thead>
<tr>
<th>线程类型</th>
<th>默认个数</th>
<th align="center">职责</th>
</tr>
</thead>
<tbody><tr>
<td>Read Thread</td>
<td>4</td>
<td align="center">主要负责读操作</td>
</tr>
<tr>
<td>Write Thread</td>
<td>4</td>
<td align="center">主要负责写操作</td>
</tr>
<tr>
<td>Log Thread</td>
<td>1</td>
<td align="center">负责将日志文件刷新到磁盘</td>
</tr>
<tr>
<td>Insert buffer Thread</td>
<td>1</td>
<td align="center">负责将写缓冲区的内容刷新到磁盘</td>
</tr>
</tbody></table>
<ul>
<li>Purge Thread</li>
</ul>
<p>主要用于undo log 的回收</p>
<ul>
<li>Page Clear Thread</li>
</ul>
<p>协助master thread对脏页的刷新，减少线程的压力</p>
<h2 id="事务原理"><a href="#事务原理" class="headerlink" title="事务原理"></a>事务原理</h2><p>原子性，一致性，持久性主要由UndoLog，RedoLog来解决</p>
<p>隔离性由Mvcc来解决</p>
<ul>
<li>持久性保证流程：Redo Log（重做日志）</li>
</ul>
<p>当客户端请求事务时，会现在内存区中BufferPool寻找该数据，若不存在，后台线程则会从磁盘中寻找该数据，并加载到缓冲池中，加载到缓冲池后，就会对数据进行变更，此时redo log会记录数据页的物理变化，当事务要提交时，会先将redolog日志刷新到磁盘中的redolog中，再将脏页中的数据刷新到磁盘中，如果脏页数据刷新过程宕机，则会通过redolog日志文件恢复数据。</p>
<p><strong>事务进行操作时，都是随机的进行操作数据页的，脏页随机刷新磁盘数据，都是随机IO，效率很低，当事务提交时先刷新日志文件，就会使整个流程变成顺序IO，提升效率，这种流程成为WAL(优先刷新日志文件)。</strong></p>
<ul>
<li>原子性保证流程：Undo Log（撤销日志）</li>
</ul>
<p>UndoLog主要记录逻辑日志（每一步执行什么样的操作），RedoLog主要记录物理日志（更改的数据），undolog可以认为当执行了一条delete语句，里面就记录了一条insert语句，而redolog记录delete掉的数据内容，。执行RollBack时，就可以执行undolog里的语句进行事务的回滚</p>
<p>undoLog销毁：当事务提交时，不会立即销毁，会看Mvcc是否还需要这个undolog</p>
<p>undolog存储：undolog存放在段中的回滚段中</p>
<h2 id="MVCC"><a href="#MVCC" class="headerlink" title="MVCC"></a>MVCC</h2><ul>
<li>当前读</li>
</ul>
<p>读取的是当前记录的最新版本，即在读取时还要保证其他并发事务不能修改记录，需要对当前记录加锁，如：select … in share mode(共享锁S), update ,delete ,insert ,select….. for update(排他锁X)都是当前读</p>
<ul>
<li>当前读</li>
</ul>
<p>简单的select就是快照读，读取的是记录数据的可见版本，在不同隔离级别下读取到的不同</p>
<ol>
<li>RC：每次select都是一个快照读</li>
<li>RR：开启事务后第一个select是快照读</li>
<li>Serilizible：快照读会退化为当前读</li>
</ol>
<ul>
<li>Mvcc</li>
</ul>
<p>多版本并发控制，指的在InnoDB中维护数据的多个版本，使读写操作没有冲突，快照读为Mysql实现了一个非阻塞读功能。Mvcc具体实现还要依赖于数据库记录的3个隐式字段，Undo Log ， readView；</p>
<ul>
<li>记录当中的隐藏字段</li>
</ul>
<ol>
<li>DB_Trx_id;记录上一个事务执行的id</li>
<li>DB_roll_Pointer; 回滚指针，记录的是数据的上一个版本，配合undolog使用</li>
<li>DB_row_id;隐藏主键，如果表没有定义主键，则会生成一个隐藏主键</li>
</ol>
<ul>
<li>UndoLog日志</li>
</ul>
<ol>
<li>insert操作，产生的undolog日志在事务提交后可以立即删除</li>
<li>update，delete操作，产生的undolog日志不可以被立即删除，还要被快照读使用</li>
</ol>
<ul>
<li>undoLog版本链</li>
</ul>
<p><img src="/2023/02/10/JavaWeb/Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20221022154609639.png" alt="image-20221022154609639"></p>
<p>链表的头部是最新的记录版本，尾部是最旧的记录</p>
<ul>
<li>readView</li>
</ul>
<p>决定select语句选择undolog版本链中的版本</p>
<table>
<thead>
<tr>
<th>字段</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>m_ids</td>
<td>当前所有活跃事务的id</td>
</tr>
<tr>
<td>min_trx_id</td>
<td>最小活跃事务的id</td>
</tr>
<tr>
<td>max_trx_id</td>
<td>预分配事务id（当前最大活跃事务id+1）</td>
</tr>
<tr>
<td>creator_ trx_id</td>
<td>创建当前readView事务的id</td>
</tr>
</tbody></table>
<p>版本数据链访问规则：</p>
<ul>
<li>如果trx_id&lt;min_trx_id：表明该事务已经提交，可以访问</li>
<li>如果trx_id&gt;max_trx_id：表明该事务在readview开启时还没有被创建，不可以被访问</li>
<li>如果trx_id &#x3D;&#x3D; creator_trx_id：表明该语句由该事务创建，可以被访问</li>
<li>如果trx_id在min_trx_id和max_trx_id之间：如果trx_id不在m_id中，表明数据已经提交，可以访问，如果trx_id在m_id中表明事务还没提交，不可以访问</li>
</ul>
<h2 id="Mysql管理"><a href="#Mysql管理" class="headerlink" title="Mysql管理"></a>Mysql管理</h2><h3 id="系统数据库"><a href="#系统数据库" class="headerlink" title="系统数据库"></a>系统数据库</h3><table>
<thead>
<tr>
<th>数据库</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>Mysql</td>
<td>存储mysql服务器正常运行所需要的各种信息（时区，主从，用户，权限）</td>
</tr>
<tr>
<td>information_schema</td>
<td>提供了访问数据库元数据的各种表和视图</td>
</tr>
<tr>
<td>performance_schema</td>
<td>包含各种锁，日志的信息</td>
</tr>
<tr>
<td>sys</td>
<td>方便dba和开发人员利用performancec_schema对数据库进行调优的视图</td>
</tr>
</tbody></table>
<h3 id="常用工具"><a href="#常用工具" class="headerlink" title="常用工具"></a>常用工具</h3><ul>
<li>mysql</li>
</ul>
<table>
<thead>
<tr>
<th>选项</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td>-u  username</td>
<td>指定用户名</td>
</tr>
<tr>
<td>-h  hostname</td>
<td>指定ip地址</td>
</tr>
<tr>
<td>-p  password</td>
<td>指定密码</td>
</tr>
<tr>
<td>-P  portname</td>
<td>指定端口</td>
</tr>
<tr>
<td>-e  sql语句</td>
<td>执行指定sql语句并退出</td>
</tr>
</tbody></table>
<p><img src="/2023/02/10/JavaWeb/Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20221022163915238.png" alt="image-20221022163915238"></p>
<p>利用-e可以执行一些批处理脚本并且不用登陆</p>
<ul>
<li>mysqladmin是一个执行管理操作的客户端程序，可以检查服务器配置和当前状态，创建并删除数据库</li>
</ul>
<p>​				mysqladmin –help可以查看所有可选的选项和指令</p>
<p><img src="/2023/02/10/JavaWeb/Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20221022164445987.png" alt="image-20221022164445987"></p>
<ul>
<li>mysqlbinlog</li>
</ul>
<p>由于服务器生成的二进制日志文件以二进制形式保存，借助这个工具查看文件</p>
<table>
<thead>
<tr>
<th>选项</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td>-d</td>
<td>之查看某个数据库相关的操作</td>
</tr>
<tr>
<td>-o</td>
<td>忽略日志文件的前多少行</td>
</tr>
<tr>
<td>-r</td>
<td>将输出的文本格式输出到指定文件中</td>
</tr>
<tr>
<td>-s</td>
<td>展示简单格式</td>
</tr>
<tr>
<td>-v</td>
<td>将行事件转换为sql语句</td>
</tr>
<tr>
<td>-w</td>
<td>将行事件转换为sql语句并加入注释</td>
</tr>
</tbody></table>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqlbinlog -s binlong.000008</span><br></pre></td></tr></table></figure>

<ul>
<li>mysqlshow客户端查找工具</li>
</ul>
<table>
<thead>
<tr>
<th>选项</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>–count</td>
<td>显示数据库及表的统计信息</td>
</tr>
<tr>
<td>-i</td>
<td>显示数据库或指定表的状态信息</td>
</tr>
</tbody></table>
<p><img src="/2023/02/10/JavaWeb/Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20221022165513387.png" alt="image-20221022165513387"></p>
<ul>
<li>mysqldump用来备份数据库或在不同数据库进行数据迁移</li>
</ul>
<table>
<thead>
<tr>
<th>输出选项</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td>–add-drop-databse</td>
<td>每个数据库语句创建前加上drop database语句</td>
</tr>
<tr>
<td>–add-drop-table</td>
<td>每个数据库语句创建前加上drop table语句</td>
</tr>
<tr>
<td>-n</td>
<td>不包含数据库的创建语句</td>
</tr>
<tr>
<td>-t</td>
<td>不包含数据表的创建语句</td>
</tr>
<tr>
<td>-d</td>
<td>不包含数据</td>
</tr>
<tr>
<td>-T</td>
<td>自动生成两个文件，一个.sql文件，创建表结构的语句，一个.txt文件，数据文件</td>
</tr>
</tbody></table>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysqldump -uroot -p1234 -t MysqlHigh student &gt; MysqlHigh_student.sql</span><br><span class="line">mysqldump -uroot -p1234 -T /etc/lib/Mysql MysqlHigh student </span><br></pre></td></tr></table></figure>

<p>通过语句，来查看mysql信任的文件夹，以存放-T选项中的sql文件和TXT文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show variables like &#x27;%secure_file_priv%&#x27;</span><br></pre></td></tr></table></figure>

<ul>
<li>Mysqlimport&#x2F;source</li>
</ul>
<p>用于导入用-T导出的文件，import导入txt文件，source导入sql文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysqlimport -uroot -p1234 MysqlHigh /etc/lib/Mysql/score.txt //在命令行中输入</span><br><span class="line">source /etc/lib/Mysql/score.sql  //这个是在mysql语句中写的</span><br></pre></td></tr></table></figure>

<h1 id="Mysql运维"><a href="#Mysql运维" class="headerlink" title="Mysql运维"></a>Mysql运维</h1><h2 id="日志"><a href="#日志" class="headerlink" title="日志"></a>日志</h2><h3 id="错误日志"><a href="#错误日志" class="headerlink" title="错误日志"></a>错误日志</h3><p>记录Mysql服务启动和停止及运行时所发生的严重错误，当服务器有问题建议优先查看服务器的错误日志，经过错误日志判定当前异常到底在哪</p>
<p>查看错误日志具体参数</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show variables like&#x27;%log_error%&#x27;;</span><br></pre></td></tr></table></figure>

<p><strong>tail -f查看当前日志尾部实时输出的内容</strong></p>
<h3 id="二进制日志"><a href="#二进制日志" class="headerlink" title="二进制日志"></a>二进制日志</h3><p>记录了所有DDL语句和DML语句，不包括数据查询语句</p>
<p>作用：</p>
<ul>
<li>灾难时的数据恢复</li>
<li>Mysql的主从复制</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show variables like &#x27;%log_bin%&#x27;; //查看二进制日志相关参数</span><br></pre></td></tr></table></figure>

<p><img src="/2023/02/10/JavaWeb/Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20221022182120381.png" alt="image-20221022182120381"></p>
<ul>
<li>log_bin_basename ：logbin文件生成的位置</li>
<li>log_bin_index：日志的索引文件，记录当前数据库的二进制日志关联的文件由哪几个</li>
</ul>
<table>
<thead>
<tr>
<th>日志格式</th>
<th>记录内容</th>
</tr>
</thead>
<tbody><tr>
<td>statement</td>
<td>记录的是sql语句</td>
</tr>
<tr>
<td>row(默认)</td>
<td>记录的是针对于每一行数据的变更，即变更前的数据和变更后的数据</td>
</tr>
<tr>
<td>mixed</td>
<td>两种格式的混合，默认使用statement，很特殊情况下会使用row</td>
</tr>
</tbody></table>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">reset master;  //删除所有二进制日志文件</span><br><span class="line">show variables like &#x27;%binlog_expire%&#x27; //查看二进制日志过期时间，可以自行设置节省磁盘空间</span><br></pre></td></tr></table></figure>

<h3 id="查询日志"><a href="#查询日志" class="headerlink" title="查询日志"></a>查询日志</h3><p>包含了客户端的所有操作语句，默认是关闭的</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show variables like &#x27;%general%&#x27;;</span><br></pre></td></tr></table></figure>

<h3 id="慢查询日志"><a href="#慢查询日志" class="headerlink" title="慢查询日志"></a>慢查询日志</h3><h2 id="主从复制"><a href="#主从复制" class="headerlink" title="主从复制"></a>主从复制</h2><p>将主库的binlog日志文件以二进制形式传输到服务器中，然后再从库上对这些日志进行重新执行</p>
<p>优点：</p>
<ul>
<li>主库出现问题，可以继续使用从库</li>
<li>实现读写分离，减轻主库的服务器压力</li>
<li>可以在从库中备份，以避免备份期间影响主库服务</li>
</ul>
<p>原理：</p>
<p><img src="/2023/02/10/JavaWeb/Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20221024145002611.png" alt="image-20221024145002611"></p>
<p>总体来说分为三部：</p>
<ul>
<li>主库将事务提交后，将具体内容写入二进制日志文件中</li>
<li>从库读取到主库的二进制日志文件中，写入到自己的r中继日志elay log日志文件中</li>
<li>从库读取自己relay log的日志文件，通过sqlthread改变自身的数据</li>
</ul>
<p>主库配置:</p>
<ul>
<li>在&#x2F;etc&#x2F;my.cnf中配置</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">server-id = 1;  Mysql服务id，保证唯一</span><br><span class="line">read-only = 0;  设置为可以进行读写，1则为只读 ，只针对普通用户</span><br><span class="line">super-read-only = 0； 设置超级管理员的读写权限</span><br></pre></td></tr></table></figure>

<ul>
<li>主库创建一个用户，赋予主从复制的权限</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">create user &#x27;itcast&#x27;@&#x27;%&#x27; identified with mysql_native_password by &#x27;Root@123456&#x27; //创建用户</span><br><span class="line"></span><br><span class="line">grant replication slave on *.* tp &#x27;itcast&#x27;@&#x27;%&#x27;;  //赋予主从复制权限</span><br></pre></td></tr></table></figure>

<ul>
<li>查看二进制日志文件坐标</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">show master stauts;</span><br><span class="line"></span><br><span class="line">//file:从哪个文件开始推送日志</span><br><span class="line">//positon：从该文件的第几行开始推送日志</span><br><span class="line">//Binlog_Do_DB: 指定需要同步的数据库</span><br><span class="line">//Binlog_Ignore_DB: 指定不需要同步的数据库</span><br></pre></td></tr></table></figure>

<p><img src="/2023/02/10/JavaWeb/Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20221026151527825.png" alt="image-20221026151527825"></p>
<p>从库配置：</p>
<p>修改从库配置文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">server-id = 2;</span><br><span class="line">read_only = 1;</span><br></pre></td></tr></table></figure>

<p>修改从库的主库信息</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">change replication source to source_host = &#x27;xxx&#x27;  //主机地址</span><br><span class="line">change replication source to source_user = &#x27;xxx&#x27;  //主库对应的用户名</span><br><span class="line">change replication source to source_password = &#x27;xxx&#x27; //对应访问密码</span><br><span class="line">change replication source to source_log_file = &#x27;xxx&#x27; //对应推送的二进制日志文件</span><br><span class="line">change replication source to source_log_pos = &#x27;xxx&#x27;  //对应的日志文件位置</span><br></pre></td></tr></table></figure>

<p>开启同步操作</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">start replica;</span><br><span class="line">show replica status; //查看主从复制状态</span><br></pre></td></tr></table></figure>

<p><img src="/2023/02/10/JavaWeb/Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20221026153217098.png" alt="image-20221026153217098"></p>
<p>IO_RUNNING:应为YES</p>
<p>SQL_RUNNING:应为YES</p>
<h2 id="分库分表"><a href="#分库分表" class="headerlink" title="分库分表"></a>分库分表</h2><h3 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h3><p>单库导致的问题</p>
<ul>
<li>IO瓶颈；热点数据太多，数据库缓存不足，产生大量<strong>磁盘IO</strong>，效率较低。请求数据过多，<strong>网络IO</strong>瓶颈</li>
<li>CPU瓶颈；排序，分组，连接查询，聚合统计等会大量消耗cpu资源，请求过多，会出现cpu瓶颈</li>
</ul>
<p>分库分表核心：将数据分散到不同的数据库存储，提升数据库性能</p>
<p>拆分维度：</p>
<p>垂直拆分：</p>
<ul>
<li><p>垂直分库：以表为依据，根据业务，将不同业务的库分到不同的数据库中</p>
</li>
<li><p>特点：每个库结构不同，每个表结构不同，所有库的并集是全部数据</p>
</li>
<li><p>垂直分表：以字段为依据，对表结构进行拆分，根据字段的属性，将不同的字段分到不同的表中</p>
</li>
<li><p>特点：每个表结构不一样，每个表数据不一样，一般通过主键，外键关联，所有表的并集是全量数据</p>
</li>
</ul>
<p>水平拆分：</p>
<ul>
<li><p>水平分库</p>
</li>
<li><p>特点：每个数据库的表结构一样，但数据不一样，所有数据库并集为全量数据</p>
</li>
<li><p>水平分表</p>
</li>
<li><p>特点：每个表结构一样，但数据不一样，所有表并集为全量数据</p>
</li>
</ul>
<p>拆分力度</p>
<ul>
<li><p>分库</p>
</li>
<li><p>分表</p>
</li>
</ul>
<h3 id="实现技术"><a href="#实现技术" class="headerlink" title="实现技术"></a>实现技术</h3><p>Mycat：数据库分库分表的中间件，不用调整代码即可实现</p>
<p>概念介绍：</p>
<p><img src="/2023/02/10/JavaWeb/Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20221026183021629.png" alt="image-20221026183021629"></p>
<p>Mycat内部不存数据，只负责一些逻辑分片和存储操作，实际数据存储在物理结构中的主机中</p>
<h2 id="读写分离"><a href="#读写分离" class="headerlink" title="读写分离"></a>读写分离</h2>
    </div>

    
    
    
     
    
   <div>
     <div>
    
        <div style="text-align:center;color: #ccc;font-size:24px;">-------------本文结束<i class="fa fa-paw"></i>------------</div>
    
</div>
   </div>
    
        

<div>
<ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>本文作者： </strong>Kim-Donghyun
  </li>
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    <a href="http://example.com/2023/02/10/JavaWeb/" title="Mysql学习">http://example.com/2023/02/10/JavaWeb/</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！
  </li>
</ul>
</div>

        

  <div class="followme">
    <p>欢迎关注我的其它发布渠道</p>

    <div class="social-list">

        <div class="social-item">
          <a target="_blank" class="social-link" href="/images/wechat_channel.jpg">
            <span class="icon">
              <i class="fa fa-wechat"></i>
            </span>

            <span class="label">微信</span>
          </a>
        </div>

        <div class="social-item">
          <a target="_blank" class="social-link" href="/atom.xml">
            <span class="icon">
              <i class="fa fa-rss"></i>
            </span>

            <span class="label">RSS</span>
          </a>
        </div>
    </div>
  </div>


      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/JDBC%EF%BC%8C%E7%8A%B6%E6%80%81%E7%A0%81%EF%BC%8CMybatis/" rel="tag"># JDBC，状态码，Mybatis</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2023/02/10/%E6%95%B0%E5%AD%97%E7%94%B5%E5%AD%90%E7%94%B5%E8%B7%AF/" rel="prev" title="数电笔记">
      <i class="fa fa-chevron-left"></i> 数电笔记
    </a></div>
      <div class="post-nav-item">
    <a href="/2023/02/10/PCB%20Layout/" rel="next" title="PCB常用规则">
      PCB常用规则 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Mysql%E5%9F%BA%E7%A1%80"><span class="nav-number">1.</span> <span class="nav-text">Mysql基础</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#DDL-x2F-DML-x2F-DQL%EF%BC%9A%E5%AF%B9%E6%95%B0%E6%8D%AE%E5%BA%93%EF%BC%8C%E8%A1%A8%E8%BF%9B%E8%A1%8C%E6%93%8D%E4%BD%9C%E7%9A%84%E8%AF%AD%E5%8F%A5"><span class="nav-number">1.1.</span> <span class="nav-text">DDL&#x2F;DML&#x2F;DQL：对数据库，表进行操作的语句</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%B9%B6%E5%8F%91%E4%BA%8B%E5%8A%A1%E9%97%AE%E9%A2%98"><span class="nav-number">1.2.</span> <span class="nav-text">并发事务问题</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%87%BD%E6%95%B0"><span class="nav-number">1.3.</span> <span class="nav-text">函数</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%87%BD%E6%95%B0"><span class="nav-number">1.3.1.</span> <span class="nav-text">字符串函数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%95%B0%E5%80%BC%E5%87%BD%E6%95%B0"><span class="nav-number">1.3.2.</span> <span class="nav-text">数值函数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%97%A5%E6%9C%9F%E5%87%BD%E6%95%B0"><span class="nav-number">1.3.3.</span> <span class="nav-text">日期函数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B5%81%E7%A8%8B%E5%87%BD%E6%95%B0"><span class="nav-number">1.3.4.</span> <span class="nav-text">流程函数</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%A4%9A%E8%A1%A8%E6%9F%A5%E8%AF%A2"><span class="nav-number">1.4.</span> <span class="nav-text">多表查询</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%81%94%E5%90%88%E6%9F%A5%E8%AF%A2-union-%EF%BC%8Cunion-all"><span class="nav-number">1.5.</span> <span class="nav-text">联合查询-union ，union all</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%B5%8C%E5%A5%97%E6%9F%A5%E8%AF%A2-x2F-%E5%AD%90%E6%9F%A5%E8%AF%A2"><span class="nav-number">1.6.</span> <span class="nav-text">嵌套查询&#x2F;子查询</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E%E5%90%84%E8%87%AA%E7%89%B9%E7%82%B9"><span class="nav-number">1.7.</span> <span class="nav-text">存储引擎各自特点</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#INNODB-%E9%BB%98%E8%AE%A4%E5%BC%95%E6%93%8E-%E4%BA%8B%E5%8A%A1%EF%BC%8C%E5%A4%96%E9%94%AE%EF%BC%8C%E8%A1%8C%E7%BA%A7%E9%94%81"><span class="nav-number">1.7.1.</span> <span class="nav-text">INNODB(默认引擎): 事务，外键，行级锁</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#MYIsam%EF%BC%9A%E4%B8%8D%E6%94%AF%E6%8C%81%E4%BA%8B%E5%8A%A1%EF%BC%8C%E4%B8%8D%E6%94%AF%E6%8C%81%E5%A4%96%E9%94%AE%EF%BC%8C%E4%B8%8D%E6%94%AF%E6%8C%81%E8%A1%8C%E9%94%81%EF%BC%8C%E6%94%AF%E6%8C%81%E8%A1%A8%E9%94%81"><span class="nav-number">1.7.2.</span> <span class="nav-text">MYIsam：不支持事务，不支持外键，不支持行锁，支持表锁</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#MeMory%EF%BC%9A%E5%86%85%E5%AD%98%E5%AD%98%E6%94%BE%EF%BC%8C%E6%94%AF%E6%8C%81Hash%E7%B4%A2%E5%BC%95"><span class="nav-number">1.7.3.</span> <span class="nav-text">MeMory：内存存放，支持Hash索引</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E%E7%9A%84%E9%80%89%E6%8B%A9"><span class="nav-number">1.7.4.</span> <span class="nav-text">存储引擎的选择:</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#JDBC"><span class="nav-number">2.</span> <span class="nav-text">JDBC</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#DriverManager"><span class="nav-number">2.1.</span> <span class="nav-text">DriverManager</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Connection"><span class="nav-number">2.2.</span> <span class="nav-text">Connection</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Statement"><span class="nav-number">2.3.</span> <span class="nav-text">Statement</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ResultSet"><span class="nav-number">2.4.</span> <span class="nav-text">ResultSet</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#prepareStatement"><span class="nav-number">2.5.</span> <span class="nav-text">prepareStatement</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E8%BF%9E%E6%8E%A5%E6%B1%A0"><span class="nav-number">2.6.</span> <span class="nav-text">数据库连接池</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Mybatis"><span class="nav-number">3.</span> <span class="nav-text">Mybatis</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="nav-number">3.1.</span> <span class="nav-text">配置文件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Mapper%E4%BB%A3%E7%90%86%E5%BC%80%E5%8F%91"><span class="nav-number">3.2.</span> <span class="nav-text">Mapper代理开发</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%B8%A6%E5%8F%82%E6%9F%A5%E8%AF%A2"><span class="nav-number">3.3.</span> <span class="nav-text">带参查询</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9D%A1%E4%BB%B6%E6%9F%A5%E8%AF%A2"><span class="nav-number">3.4.</span> <span class="nav-text">条件查询</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8A%A8%E6%80%81%E6%9F%A5%E8%AF%A2"><span class="nav-number">3.5.</span> <span class="nav-text">动态查询</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8D%95%E9%80%89%E6%8B%A9%E5%A4%9A%E6%9D%A1%E4%BB%B6%E5%8A%A8%E6%80%81%E6%9F%A5%E8%AF%A2"><span class="nav-number">3.5.1.</span> <span class="nav-text">单选择多条件动态查询</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%8F%92%E5%85%A5%E6%95%B0%E6%8D%AE"><span class="nav-number">3.6.</span> <span class="nav-text">插入数据</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%89%B9%E9%87%8F%E5%88%A0%E9%99%A4"><span class="nav-number">3.7.</span> <span class="nav-text">批量删除</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Mybatis%E5%8F%82%E6%95%B0%E4%BC%A0%E9%80%92"><span class="nav-number">3.8.</span> <span class="nav-text">Mybatis参数传递</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%A4%9A%E4%B8%AA%E5%8F%82%E6%95%B0%E4%BC%A0%E9%80%92%EF%BC%8C%E4%BC%9A%E5%B0%81%E8%A3%85%E8%BF%9BMap%E9%9B%86%E5%90%88%E4%B8%AD"><span class="nav-number">3.8.1.</span> <span class="nav-text">多个参数传递，会封装进Map集合中</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8D%95%E4%B8%AA%E5%8F%82%E6%95%B0"><span class="nav-number">3.8.2.</span> <span class="nav-text">单个参数</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E6%B3%A8%E8%A7%A3%E5%AE%8C%E6%88%90%E5%A2%9E%E5%88%A0%E6%94%B9%E6%9F%A5"><span class="nav-number">3.9.</span> <span class="nav-text">使用注解完成增删改查</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#JavaWeb%E6%A0%B8%E5%BF%83"><span class="nav-number">4.</span> <span class="nav-text">JavaWeb核心</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Http%E4%BC%A0%E8%BE%93%E5%8D%8F%E8%AE%AE"><span class="nav-number">4.1.</span> <span class="nav-text">Http传输协议</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%AF%B7%E6%B1%82%E6%95%B0%E6%8D%AE%E9%83%A8%E5%88%86"><span class="nav-number">4.2.</span> <span class="nav-text">请求数据部分</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%93%8D%E5%BA%94%E6%95%B0%E6%8D%AE%E9%83%A8%E5%88%86"><span class="nav-number">4.3.</span> <span class="nav-text">响应数据部分</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%8A%B6%E6%80%81%E7%A0%81%E5%A4%A7%E7%B1%BB"><span class="nav-number">4.4.</span> <span class="nav-text">状态码大类</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%B8%B8%E8%A7%81%E7%9A%84%E5%93%8D%E5%BA%94%E7%8A%B6%E6%80%81%E7%A0%81"><span class="nav-number">4.5.</span> <span class="nav-text">常见的响应状态码</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Mysql%E8%BF%9B%E9%98%B6"><span class="nav-number">5.</span> <span class="nav-text">Mysql进阶</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%B4%A2%E5%BC%95"><span class="nav-number">5.1.</span> <span class="nav-text">索引</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#B-Tree%EF%BC%9A%E5%A4%9A%E8%B7%AF%E5%B9%B3%E8%A1%A1%E6%9F%A5%E6%89%BE%E6%A0%91"><span class="nav-number">5.2.</span> <span class="nav-text">B-Tree：多路平衡查找树</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#B-Tree%EF%BC%9AB%E6%A0%91%E5%8F%98%E7%A7%8D"><span class="nav-number">5.3.</span> <span class="nav-text">B+Tree：B树变种</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Hash%E7%B4%A2%E5%BC%95"><span class="nav-number">5.4.</span> <span class="nav-text">Hash索引</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E4%BD%BF%E7%94%A8B-%E6%A0%91"><span class="nav-number">5.5.</span> <span class="nav-text">为什么使用B+树</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%B4%A2%E5%BC%95%E5%88%86%E7%B1%BB"><span class="nav-number">5.6.</span> <span class="nav-text">索引分类</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%B4%A2%E5%BC%95%E7%9B%B8%E5%85%B3%E8%AF%AD%E5%8F%A5"><span class="nav-number">5.7.</span> <span class="nav-text">索引相关语句</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%80%A7%E8%83%BD%E5%88%86%E6%9E%90"><span class="nav-number">5.8.</span> <span class="nav-text">性能分析</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%B4%A2%E5%BC%95%E4%BD%BF%E7%94%A8%E5%8E%9F%E5%88%99"><span class="nav-number">5.9.</span> <span class="nav-text">索引使用原则</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%A6%86%E7%9B%96%E7%B4%A2%E5%BC%95%E5%92%8C%E5%9B%9E%E8%A1%A8%E6%9F%A5%E8%AF%A2"><span class="nav-number">5.10.</span> <span class="nav-text">覆盖索引和回表查询</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%89%8D%E7%BC%80%E7%B4%A2%E5%BC%95"><span class="nav-number">5.11.</span> <span class="nav-text">前缀索引</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%B4%A2%E5%BC%95%E8%AE%BE%E8%AE%A1%E5%8E%9F%E5%88%99"><span class="nav-number">5.12.</span> <span class="nav-text">索引设计原则</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%80%BB%E7%BB%93"><span class="nav-number">5.13.</span> <span class="nav-text">总结</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#SQL%E5%85%B6%E4%BB%96%E8%AF%AD%E5%8F%A5%E4%BC%98%E5%8C%96"><span class="nav-number">5.14.</span> <span class="nav-text">SQL其他语句优化</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Insert%E4%BC%98%E5%8C%96"><span class="nav-number">5.14.1.</span> <span class="nav-text">Insert优化</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%BB%E9%94%AE%E4%BC%98%E5%8C%96"><span class="nav-number">5.14.2.</span> <span class="nav-text">主键优化</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#OrderBy%E4%BC%98%E5%8C%96"><span class="nav-number">5.14.3.</span> <span class="nav-text">OrderBy优化</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#GroupBy%E4%BC%98%E5%8C%96"><span class="nav-number">5.14.4.</span> <span class="nav-text">GroupBy优化</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Limit%E4%BC%98%E5%8C%96"><span class="nav-number">5.14.5.</span> <span class="nav-text">Limit优化</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Count%E4%BC%98%E5%8C%96"><span class="nav-number">5.14.6.</span> <span class="nav-text">Count优化</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Update%E4%BC%98%E5%8C%96"><span class="nav-number">5.14.7.</span> <span class="nav-text">Update优化</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%A7%86%E5%9B%BE"><span class="nav-number">5.15.</span> <span class="nav-text">视图</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B"><span class="nav-number">5.16.</span> <span class="nav-text">存储过程</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9F%BA%E6%9C%AC%E8%AF%AD%E6%B3%95"><span class="nav-number">5.16.1.</span> <span class="nav-text">基本语法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%B3%BB%E7%BB%9F%E5%8F%98%E9%87%8F"><span class="nav-number">5.16.2.</span> <span class="nav-text">系统变量</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%94%A8%E6%88%B7%E8%87%AA%E5%AE%9A%E4%B9%89%E5%8F%98%E9%87%8F"><span class="nav-number">5.16.3.</span> <span class="nav-text">用户自定义变量</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B1%80%E9%83%A8%E5%8F%98%E9%87%8F"><span class="nav-number">5.16.4.</span> <span class="nav-text">局部变量</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B%E7%9A%84%E5%8F%82%E6%95%B0"><span class="nav-number">5.16.5.</span> <span class="nav-text">存储过程的参数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#If%E5%9F%BA%E6%9C%AC%E8%AF%AD%E6%B3%95"><span class="nav-number">5.16.6.</span> <span class="nav-text">If基本语法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Case%E8%AF%AD%E6%B3%95"><span class="nav-number">5.16.7.</span> <span class="nav-text">Case语法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BE%AA%E7%8E%AF%E7%BB%93%E6%9E%84"><span class="nav-number">5.16.8.</span> <span class="nav-text">循环结构</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B8%B8%E6%A0%87cursor"><span class="nav-number">5.16.9.</span> <span class="nav-text">游标cursor</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AD%98%E5%82%A8%E5%87%BD%E6%95%B0"><span class="nav-number">5.16.10.</span> <span class="nav-text">存储函数</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%A7%A6%E5%8F%91%E5%99%A8"><span class="nav-number">5.17.</span> <span class="nav-text">触发器</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%94%81"><span class="nav-number">5.18.</span> <span class="nav-text">锁</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%85%A8%E5%B1%80%E9%94%81"><span class="nav-number">5.18.1.</span> <span class="nav-text">全局锁</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%A1%A8%E7%BA%A7%E9%94%81"><span class="nav-number">5.18.2.</span> <span class="nav-text">表级锁</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%A1%A8%E9%94%81"><span class="nav-number">5.18.2.1.</span> <span class="nav-text">表锁</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%85%83%E6%95%B0%E6%8D%AE%E9%94%81%EF%BC%88MDL%EF%BC%89"><span class="nav-number">5.18.2.2.</span> <span class="nav-text">元数据锁（MDL）</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%84%8F%E5%90%91%E9%94%81"><span class="nav-number">5.18.2.3.</span> <span class="nav-text">意向锁</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%A1%8C%E7%BA%A7%E9%94%81"><span class="nav-number">5.18.3.</span> <span class="nav-text">行级锁</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#InnoDB%E5%BC%95%E6%93%8E%E5%BA%95%E5%B1%82"><span class="nav-number">5.19.</span> <span class="nav-text">InnoDB引擎底层</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%80%BB%E8%BE%91%E5%AD%98%E5%82%A8%E7%BB%93%E6%9E%84"><span class="nav-number">5.19.1.</span> <span class="nav-text">逻辑存储结构</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%86%85%E5%AD%98%E7%BB%93%E6%9E%84"><span class="nav-number">5.19.2.</span> <span class="nav-text">内存结构</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%A3%81%E7%9B%98%E7%BB%93%E6%9E%84"><span class="nav-number">5.19.3.</span> <span class="nav-text">磁盘结构</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%90%8E%E5%8F%B0%E7%BA%BF%E7%A8%8B"><span class="nav-number">5.19.4.</span> <span class="nav-text">后台线程</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BA%8B%E5%8A%A1%E5%8E%9F%E7%90%86"><span class="nav-number">5.20.</span> <span class="nav-text">事务原理</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#MVCC"><span class="nav-number">5.21.</span> <span class="nav-text">MVCC</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Mysql%E7%AE%A1%E7%90%86"><span class="nav-number">5.22.</span> <span class="nav-text">Mysql管理</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%B3%BB%E7%BB%9F%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="nav-number">5.22.1.</span> <span class="nav-text">系统数据库</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B8%B8%E7%94%A8%E5%B7%A5%E5%85%B7"><span class="nav-number">5.22.2.</span> <span class="nav-text">常用工具</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Mysql%E8%BF%90%E7%BB%B4"><span class="nav-number">6.</span> <span class="nav-text">Mysql运维</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%97%A5%E5%BF%97"><span class="nav-number">6.1.</span> <span class="nav-text">日志</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%94%99%E8%AF%AF%E6%97%A5%E5%BF%97"><span class="nav-number">6.1.1.</span> <span class="nav-text">错误日志</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BA%8C%E8%BF%9B%E5%88%B6%E6%97%A5%E5%BF%97"><span class="nav-number">6.1.2.</span> <span class="nav-text">二进制日志</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9F%A5%E8%AF%A2%E6%97%A5%E5%BF%97"><span class="nav-number">6.1.3.</span> <span class="nav-text">查询日志</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%85%A2%E6%9F%A5%E8%AF%A2%E6%97%A5%E5%BF%97"><span class="nav-number">6.1.4.</span> <span class="nav-text">慢查询日志</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6"><span class="nav-number">6.2.</span> <span class="nav-text">主从复制</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%86%E5%BA%93%E5%88%86%E8%A1%A8"><span class="nav-number">6.3.</span> <span class="nav-text">分库分表</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%A6%82%E8%BF%B0"><span class="nav-number">6.3.1.</span> <span class="nav-text">概述</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%9E%E7%8E%B0%E6%8A%80%E6%9C%AF"><span class="nav-number">6.3.2.</span> <span class="nav-text">实现技术</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%AF%BB%E5%86%99%E5%88%86%E7%A6%BB"><span class="nav-number">6.4.</span> <span class="nav-text">读写分离</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Kim-Donghyun"
      src="/images/avatar.gif">
  <p class="site-author-name" itemprop="name">Kim-Donghyun</p>
  <div class="site-description" itemprop="description">希望现在的自己配得上所期望的生活</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">12</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">8</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">3</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/Martin01Kim" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;Martin01Kim" rel="noopener" target="_blank"><i class="fa fa-cloud fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="/2302539593@qq.com" title="E-Mail → 2302539593@qq.com"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>


  <div class="links-of-blogroll motion-element">
    <div class="links-of-blogroll-title"><i class="link fa-fw"></i>
      自用网站
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="https://blog.csdn.net/weixin_44407238/article/details/112799416" title="https:&#x2F;&#x2F;blog.csdn.net&#x2F;weixin_44407238&#x2F;article&#x2F;details&#x2F;112799416" rel="noopener" target="_blank">硬件知识</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://space.bilibili.com/31880831/?spm_id_from=333.999.0.0" title="https:&#x2F;&#x2F;space.bilibili.com&#x2F;31880831&#x2F;?spm_id_from&#x3D;333.999.0.0" rel="noopener" target="_blank">高质量网课</a>
        </li>
    </ul>
  </div>

      </div>
        <div class="back-to-top motion-element">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>

      
<script type="text/javascript" charset="utf-8" src="/js/tagcloud.js"></script>
<script type="text/javascript" charset="utf-8" src="/js/tagcanvas.js"></script>
<div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div id="myCanvasContainer" class="widget tagcloud">
        <canvas width="250" height="250" id="resCanvas" style="width=100%">
            <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Buck-Boost-Ldo/" rel="tag">Buck,Boost,Ldo</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/I2C%E3%80%81SPI%E3%80%81UART%E3%80%81RS232%E3%80%81RS485%E3%80%81USB/" rel="tag">I2C、SPI、UART、RS232、RS485、USB</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JDBC%EF%BC%8C%E7%8A%B6%E6%80%81%E7%A0%81%EF%BC%8CMybatis/" rel="tag">JDBC，状态码，Mybatis</a><span class="tag-list-count">1</span></li></ul>
        </canvas>
    </div>
</div>



    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 2023-01 – 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Kim-Donghyun</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>
 
<div class="theme-info">
  <div class="powered-by"></div>
  <span class="post-count">博客全站共50.9k字</span>
</div>
        








      </div>
    </footer>
  </div>

  
  
  <script color='0,0,255' opacity='0.5' zIndex='-1' count='99' src="/lib/canvas-nest/canvas-nest.min.js"></script>
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

</body>
</html>
<!-- 页面点击小红心 -->
<script type="text/javascript" src="/js/clicklove.js"></script>
